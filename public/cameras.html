<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∞–º–µ—Ä—ã - –£–ö ¬´–ó–µ–ª—ë–Ω–∞—è –¥–æ–ª–∏–Ω–∞¬ª v6.4.0</title>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#2E7D32">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="icon" type="image/png" sizes="32x32" href="./icon-48x48.png">
    <link rel="icon" type="image/png" sizes="192x192" href="./icon-192x192.png">
    <link rel="apple-touch-icon" sizes="180x180" href="./icon-180x180.png">
    
    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
    <link rel="stylesheet" href="css/navigation.css">
    <script src="js/navigation.js" defer></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
            min-height: 100vh;
            padding: 20px 20px 100px 20px;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 5px;
        }
        
        .back-button {
            position: fixed;
            top: 20px;
            left: 20px;
            background: white;
            border: none;
            border-radius: 50%;
            width: 48px;
            height: 48px;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            z-index: 100;
        }
        
        .cameras-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .camera-card {
            background: white;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .camera-card:hover {
            transform: translateY(-4px);
        }
        
        .camera-preview {
            width: 100%;
            height: 200px;
            background: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        
        .camera-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .camera-status {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .camera-status.online {
            background: #4CAF50;
            color: white;
        }
        
        .camera-status.offline {
            background: #F44336;
            color: white;
        }
        
        .camera-info {
            padding: 16px;
        }
        
        .camera-name {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }
        
        .camera-location {
            font-size: 14px;
            color: #666;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 10000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.show {
            display: flex;
        }
        
        .modal-content {
            max-width: 90%;
            max-height: 90%;
            position: relative;
        }
        
        .modal-content video,
        .modal-content img {
            max-width: 100%;
            max-height: 90vh;
            border-radius: 12px;
        }
        
        .modal-close {
            position: absolute;
            top: -40px;
            right: 0;
            background: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 24px;
            cursor: pointer;
            color: #333;
        }
        
        .camera-placeholder {
            font-size: 48px;
            color: #ccc;
        }
    </style>
    
    <!-- –ì–ª–æ–±–∞–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç –æ—à–∏–±–æ–∫ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π -->
    <script>
        // ====================================
        // üõ°Ô∏è –ì–õ–û–ë–ê–õ–¨–ù–ê–Ø –ó–ê–©–ò–¢–ê –û–¢ –û–®–ò–ë–û–ö –†–ê–°–®–ò–†–ï–ù–ò–ô v6.4.7
        // ====================================
        
        (function() {
            'use strict';
            
            // –°—á—ë—Ç—á–∏–∫ –ø–æ–¥–∞–≤–ª–µ–Ω–Ω—ã—Ö –æ—à–∏–±–æ–∫ (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏)
            let suppressedErrors = 0;
            
            // –°–ø–∏—Å–æ–∫ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –æ—à–∏–±–æ–∫ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π
            const extensionErrorPatterns = [
                'message channel closed',
                'Extension context invalidated',
                'chrome-extension://',
                'moz-extension://',
                'content_script.js',
                'Cannot read properties of undefined',
                'reading \'control\'',
                'reading \'runtime\'',
                'sending a message',
                'Receiving end does not exist',
                'Could not establish connection'
            ];
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –æ—à–∏–±–∫–∞ –æ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
            function isExtensionError(errorMessage, errorStack) {
                if (!errorMessage && !errorStack) return false;
                
                const fullText = (errorMessage || '') + ' ' + (errorStack || '');
                
                return extensionErrorPatterns.some(pattern => 
                    fullText.toLowerCase().includes(pattern.toLowerCase())
                );
            }
            
            // –ì–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫
            const originalErrorHandler = window.onerror;
            window.onerror = function(message, source, lineno, colno, error) {
                if (isExtensionError(message, error ? error.stack : '')) {
                    suppressedErrors++;
                    console.warn(
                        `[Global] üõ°Ô∏è –ü–æ–¥–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è #${suppressedErrors}:`, 
                        message.substring(0, 100)
                    );
                    return true; // –ü–æ–¥–∞–≤–∏—Ç—å –æ—à–∏–±–∫—É
                }
                
                // –ü–µ—Ä–µ–¥–∞—Ç—å –¥—Ä—É–≥–∏–µ –æ—à–∏–±–∫–∏ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–º—É –æ–±—Ä–∞–±–æ—Ç—á–∏–∫—É
                if (originalErrorHandler) {
                    return originalErrorHandler.apply(this, arguments);
                }
                return false;
            };
            
            // –ì–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ unhandled promise rejections
            window.addEventListener('unhandledrejection', function(event) {
                const reason = event.reason;
                const message = reason ? (reason.message || reason.toString()) : '';
                const stack = reason ? reason.stack : '';
                
                if (isExtensionError(message, stack)) {
                    suppressedErrors++;
                    console.warn(
                        `[Global] üõ°Ô∏è –ü–æ–¥–∞–≤–ª–µ–Ω Promise rejection #${suppressedErrors}:`, 
                        message.substring(0, 100)
                    );
                    event.preventDefault();
                }
            });
            
            // –ì–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏–π focus (–≥–¥–µ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –æ—à–∏–±–∫–∞ content_script)
            document.addEventListener('focusin', function(event) {
                // –û–±–µ—Ä–Ω—É—Ç—å –≤ try-catch –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –æ—à–∏–±–æ–∫ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π
                try {
                    // –ö–æ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–æ–∫—É—Å–∞ (–µ—Å–ª–∏ –Ω—É–∂–µ–Ω)
                } catch (error) {
                    if (isExtensionError(error.message, error.stack)) {
                        suppressedErrors++;
                        console.warn('[Global] üõ°Ô∏è –ü–æ–¥–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ focusin –æ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è');
                    }
                }
            }, true); // true = capture phase (–¥–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π)
            
            // –û—Ç—á—ë—Ç –æ –ø–æ–¥–∞–≤–ª–µ–Ω–Ω—ã—Ö –æ—à–∏–±–∫–∞—Ö (–∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥)
            setInterval(function() {
                if (suppressedErrors > 0) {
                    console.log(`[Global] üìä –ü–æ–¥–∞–≤–ª–µ–Ω–æ –æ—à–∏–±–æ–∫ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π: ${suppressedErrors}`);
                }
            }, 10000);
            
            console.log('[Global] üõ°Ô∏è –ó–∞—â–∏—Ç–∞ –æ—Ç –æ—à–∏–±–æ–∫ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π v6.4.7 –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞');
            console.log('[Global] üìã –û—Ç—Å–ª–µ–∂–∏–≤–∞—é—Ç—Å—è –ø–∞—Ç—Ç–µ—Ä–Ω—ã:', extensionErrorPatterns.length);
        })();
    </script>
    
    <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –ø–æ–ª–µ–π –≤–≤–æ–¥–∞ -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // –û—Ç–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –Ω–∞ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –ø–æ–ª—è—Ö (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
            const sensitiveFields = document.querySelectorAll('input[type="tel"], input[type="text"]');
            sensitiveFields.forEach(field => {
                // –î–æ–±–∞–≤–∏—Ç—å –∞—Ç—Ä–∏–±—É—Ç—ã –¥–ª—è –æ—Ç–∫–ª—é—á–µ–Ω–∏—è –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã—Ö —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π
                field.setAttribute('autocomplete', 'off');
                field.setAttribute('data-lpignore', 'true'); // LastPass
                field.setAttribute('data-form-type', 'other'); // 1Password
                field.setAttribute('data-bwignore', 'true'); // Bitwarden
            });
            
            console.log('[Fields] üîí –ó–∞—â–∏—Ç–∞ –ø–æ–ª–µ–π –≤–≤–æ–¥–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ –∫', sensitiveFields.length, '—ç–ª–µ–º–µ–Ω—Ç–∞–º');
        });
    </script>
</head>
<body>
    <button class="back-button" onclick="window.location.href='index.html'">‚Üê</button>
    
    <div class="header">
        <h1>üìπ –í–∏–¥–µ–æ–Ω–∞–±–ª—é–¥–µ–Ω–∏–µ</h1>
        <div style="font-size: 14px; opacity: 0.9;">8 –∏–∑ 10 –∫–∞–º–µ—Ä –æ–Ω–ª–∞–π–Ω</div>
    </div>
    
    <div class="cameras-grid" id="camerasGrid">
        <!-- –ö–∞–º–µ—Ä—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤–∏–¥–µ–æ -->
    <div id="cameraModal" class="modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeCameraModal()">‚úï</button>
            <div id="modalVideo"></div>
        </div>
    </div>
    
    <script src="auth.js"></script>
    <script>
        // –í–ê–ñ–ù–û: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –¢–û–õ–¨–ö–û –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ DOM
        document.addEventListener('DOMContentLoaded', () => {
            console.log('[Page] –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏...');
            
            if (!requireAuth()) {
                console.log('[Page] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω, —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ login');
                return;
            }
            
            console.log('[Page] –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã...');
            initializePage();
        });
        
        // –î–∞–Ω–Ω—ã–µ –∫–∞–º–µ—Ä (mock) - –≥–ª–æ–±–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è
        const cameras = [
            { id: 1, name: '–ü–æ–¥—ä–µ–∑–¥ 1', location: '–í—Ö–æ–¥ –≤ –ø–æ–¥—ä–µ–∑–¥ ‚Ññ1', status: 'online', snapshot: null },
            { id: 2, name: '–ü–∞—Ä–∫–æ–≤–∫–∞', location: '–ü–∞—Ä–∫–æ–≤–æ—á–Ω–∞—è –∑–æ–Ω–∞', status: 'online', snapshot: null },
            { id: 3, name: '–î–µ—Ç—Å–∫–∞—è –ø–ª–æ—â–∞–¥–∫–∞', location: '–ò–≥—Ä–æ–≤–∞—è –∑–æ–Ω–∞', status: 'offline', snapshot: null },
            { id: 4, name: '–í—ä–µ–∑–¥ –≤ –ñ–ö', location: '–ì–ª–∞–≤–Ω—ã–π –≤—ä–µ–∑–¥', status: 'online', snapshot: null },
            { id: 5, name: '–ü–æ–¥—ä–µ–∑–¥ 2', location: '–í—Ö–æ–¥ –≤ –ø–æ–¥—ä–µ–∑–¥ ‚Ññ2', status: 'online', snapshot: null },
            { id: 6, name: '–ü–æ–¥—ä–µ–∑–¥ 3', location: '–í—Ö–æ–¥ –≤ –ø–æ–¥—ä–µ–∑–¥ ‚Ññ3', status: 'online', snapshot: null },
            { id: 7, name: '–ú—É—Å–æ—Ä–Ω–∞—è –ø–ª–æ—â–∞–¥–∫–∞', location: '–ó–æ–Ω–∞ —Å–±–æ—Ä–∞ –º—É—Å–æ—Ä–∞', status: 'online', snapshot: null },
            { id: 8, name: '–°–ø–æ—Ä—Ç–∏–≤–Ω–∞—è –ø–ª–æ—â–∞–¥–∫–∞', location: '–ó–æ–Ω–∞ –æ—Ç–¥—ã—Ö–∞', status: 'online', snapshot: null },
            { id: 9, name: '–ü–æ–¥—ä–µ–∑–¥ 4', location: '–í—Ö–æ–¥ –≤ –ø–æ–¥—ä–µ–∑–¥ ‚Ññ4', status: 'offline', snapshot: null },
            { id: 10, name: '–ü–∞—Ä–∫–æ–≤–∫–∞ (–∑–∞–¥–Ω—è—è)', location: '–ó–∞–¥–Ω—è—è –ø–∞—Ä–∫–æ–≤–∫–∞', status: 'online', snapshot: null }
        ];
        
        function loadCameras() {
            const grid = document.getElementById('camerasGrid');
            grid.innerHTML = '';
            
            cameras.forEach(camera => {
                const card = document.createElement('div');
                card.className = 'camera-card';
                card.onclick = () => openCameraStream(camera.id);
                
                card.innerHTML = `
                    <div class="camera-preview">
                        ${camera.status === 'online' 
                            ? '<div class="camera-placeholder">üìπ</div>' 
                            : '<div class="camera-placeholder" style="opacity: 0.3;">üìπ</div>'}
                        <div class="camera-status ${camera.status}">
                            ${camera.status === 'online' ? '–û–Ω–ª–∞–π–Ω' : '–û—Ñ–ª–∞–π–Ω'}
                        </div>
                    </div>
                    <div class="camera-info">
                        <div class="camera-name">${camera.name}</div>
                        <div class="camera-location">${camera.location}</div>
                    </div>
                `;
                
                grid.appendChild(card);
            });
        }
        
        function openCameraStream(cameraId) {
            const camera = cameras.find(c => c.id === cameraId);
            if (!camera) return;
            
            if (camera.status === 'offline') {
                alert('–ö–∞–º–µ—Ä–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞');
                return;
            }
            
            const modal = document.getElementById('cameraModal');
            const modalVideo = document.getElementById('modalVideo');
            
            // Mock: –ø–æ–∫–∞–∑–∞—Ç—å –≤–∏–¥–µ–æ –∏–ª–∏ –∑–∞–≥–ª—É—à–∫—É
            modalVideo.innerHTML = `
                <div style="background: #1a1a1a; padding: 40px; border-radius: 12px; text-align: center; color: white; min-width: 400px; min-height: 300px; display: flex; align-items: center; justify-content: center; flex-direction: column;">
                    <div style="font-size: 64px; margin-bottom: 20px;">üìπ</div>
                    <div style="font-size: 20px; font-weight: 600; margin-bottom: 10px;">${camera.name}</div>
                    <div style="font-size: 14px; color: #999; margin-bottom: 20px;">${camera.location}</div>
                    <div style="font-size: 14px; color: #666;">
                        –í production: –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å API –¢–µ–ª–µ–∫–æ–º –õ–µ—Ç–∞–π<br>
                        –ü—Ä—è–º–∞—è —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏—è —Å –∫–∞–º–µ—Ä—ã ${cameraId}
                    </div>
                </div>
            `;
            
            modal.classList.add('show');
        }
        
        function closeCameraModal() {
            const modal = document.getElementById('cameraModal');
            modal.classList.remove('show');
        }
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –µ–≥–æ
        document.getElementById('cameraModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeCameraModal();
            }
        });
        
        function initializePage() {
            const session = getSession();
            console.log('[Page] –°–µ—Å—Å–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', session);
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞–º–µ—Ä –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
            loadCameras();
        }
    </script>
</body>
</html>

