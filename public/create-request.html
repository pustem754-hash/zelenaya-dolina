<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞ - –£–ö –ó–µ–ª—ë–Ω–∞—è –¥–æ–ª–∏–Ω–∞ v7.0</title>
    
    <!-- Design System v7.0 -->
    <link rel="stylesheet" href="css/design-system.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/layout.css">
    <link rel="stylesheet" href="css/animations.css">
    <link rel="stylesheet" href="css/layout-fixes.css">
    <link rel="stylesheet" href="css/brand.css">
    <link rel="stylesheet" href="css/modern-ui.css">
    
    <script src="js/ui-modern.js" defer></script>
    <script src="js/media-modern.js" defer></script>
</head>
<body>

    <!-- Header -->
    <header class="header-modern">
        <button class="btn-icon" onclick="window.location.href='index.html'"></button>
        <h1 style="font-size: 18px; margin:0;">–ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞</h1>
        <button class="btn-icon" onclick="uiModern.toggleTheme()">üåì</button>
    </header>

    <div class="container animate-fade">
        
        <!-- VSK Desk Widget -->
         <div class="card card-glass" style="margin-top: 20px; text-align: center; border: 1px solid #e0e0e0; padding: 12px;">
            <p style="font-size: 10px; color: var(--color-text-secondary); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 4px;">–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞—è–≤–∫–∞–º–∏</p>
            <h3 style="margin: 0; color: #444; font-size: 14px; display:flex; align-items:center; justify-content:center; gap:6px;">
                <span style="font-size:16px;"></span> VSK DESK INTEGRATION
            </h3>
        </div>

        <form id="requestForm" class="card" style="margin-top: 20px;">
            <div id="errorMessage" class="alert alert-error" style="display:none;"></div>
            
            <!-- Category -->
            <div class="form-group" style="margin-bottom: 20px;">
                <label style="display:block; margin-bottom: 8px; font-weight: 500;">–ö–∞—Ç–µ–≥–æ—Ä–∏—è –ø—Ä–æ–±–ª–µ–º—ã</label>
                <select id="requestCategory" class="input-modern" required>
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
                    <option value="plumbing"> –°–∞–Ω—Ç–µ—Ö–Ω–∏–∫–∞</option>
                    <option value="electricity"> –≠–ª–µ–∫—Ç—Ä–∏–∫–∞</option>
                    <option value="heating"> –û—Ç–æ–ø–ª–µ–Ω–∏–µ</option>
                    <option value="doors"> –î–≤–µ—Ä–∏/–∑–∞–º–∫–∏</option>
                    <option value="cleaning"> –£–±–æ—Ä–∫–∞</option>
                    <option value="other"> –î—Ä—É–≥–æ–µ</option>
                </select>
            </div>
            
            <!-- Title -->
            <div class="form-group" style="margin-bottom: 20px;">
                <label style="display:block; margin-bottom: 8px; font-weight: 500;">–¢–µ–º–∞</label>
                <input type="text" id="requestTitle" class="input-modern" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ü—Ä–æ—Ç–µ—á–∫–∞ –∫—Ä–∞–Ω–∞" required>
            </div>
            
            <!-- Description -->
            <div class="form-group" style="margin-bottom: 20px;">
                <label style="display:block; margin-bottom: 8px; font-weight: 500;">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                <textarea id="requestDescription" class="input-modern" rows="4" placeholder="–û–ø–∏—à–∏—Ç–µ –ø—Ä–æ–±–ª–µ–º—É –ø–æ–¥—Ä–æ–±–Ω–æ..." required></textarea>
                 <div style="text-align: right; font-size: 12px; color: #999; margin-top: 4px;">
                    <span id="charCount">0</span>/1000
                </div>
            </div>

             <!-- Media Buttons -->
            <label style="display:block; margin-bottom: 12px; font-weight: 500;">–§–æ—Ç–æ –∏ –≤–∏–¥–µ–æ —Ñ–∏–∫—Å–∞—Ü–∏—è</label>
            <div class="grid-3" style="gap: 12px; margin-bottom: 20px;">
                <!-- Photo -->
                <label class="card card-glass" style="padding: 16px; text-align: center; cursor: pointer; border: 1px dashed var(--color-primary);" for="photoFileInput">
                    <span style="font-size: 24px;">üìÅ</span>
                    <div style="font-size: 12px; margin-top: 4px; color: var(--color-primary);">–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ</div>
                    <input type="file" id="photoFileInput" accept="image/*" capture="environment" style="display: none;" onchange="if(window.mediaFixed) mediaFixed.handlePhotoUpload(event);">
                </label>
                <button type="button" class="card card-glass" style="padding: 16px; text-align: center; border: 1px dashed var(--color-primary); background: var(--color-primary-light); color: var(--color-primary); font-weight: 700;" onclick="capturePhoto()">
                    <div style="font-size: 24px;">üì∏</div>
                    <div style="font-size: 12px; margin-top: 4px;">–°–¥–µ–ª–∞—Ç—å —Ñ–æ—Ç–æ (–∫–∞–º–µ—Ä–∞)</div>
                </button>

                <!-- Video -->
                <label class="card card-glass" style="padding: 16px; text-align: center; cursor: pointer; border: 1px dashed #2196F3;">
                    <span style="font-size: 24px;">üé•</span>
                    <div style="font-size: 12px; margin-top: 4px; color: #2196F3;">–í–∏–¥–µ–æ</div>
                    <input type="file" id="videoInput" accept="video/*" capture="environment" style="display: none;" onchange="handleVideoUpload(event)">
                </label>

                <!-- Audio -->
                <label class="card card-glass" style="padding: 16px; text-align: center; cursor: pointer; border: 1px dashed #FF9800;">
                    <span style="font-size: 24px;">üé§</span>
                    <div style="font-size: 12px; margin-top: 4px; color: #FF9800;">–ê—É–¥–∏–æ</div>
                    <input type="file" id="audioInput" accept="audio/*" capture="microphone" style="display: none;" onchange="handleAudioUpload(event)">
                </label>
            </div>

            <div id="liveCameraContainer" class="media-preview" style="display:none; margin-bottom: 12px;"></div>

            <!-- Media Previews -->
            <div id="mediaPreviewContainer">
                <div id="photoPreviewBlock" class="media-preview" style="display: none; position: relative; margin-bottom: 12px;">
                    <img id="photoPreview" style="width: 100%; border-radius: 12px;">
                    <button type="button" onclick="deletePhoto()" style="position: absolute; top: 8px; right: 8px; background: rgba(0,0,0,0.5); color: white; border: none; width: 32px; height: 32px; border-radius: 50%;"></button>
                </div>
                <div id="videoPreviewBlock" class="media-preview" style="display: none; position: relative; margin-bottom: 12px;">
                    <video id="videoPreview" controls style="width: 100%; border-radius: 12px;"></video>
                    <button type="button" onclick="deleteVideo()" style="position: absolute; top: 8px; right: 8px; background: rgba(0,0,0,0.5); color: white; border: none; width: 32px; height: 32px; border-radius: 50%;"></button>
                </div>
                 <div id="audioPreviewBlock" class="media-preview" style="display: none; position: relative; margin-bottom: 12px; background: #f5f5f5; padding: 12px; border-radius: 12px; align-items: center; gap: 10px;">
                    <span style="font-size: 24px;">üéµ</span>
                    <audio id="audioPreview" controls style="flex: 1; height: 32px;"></audio>
                    <button type="button" onclick="deleteAudio()" style="background: none; border: none; color: #F44336; font-size: 20px;"></button>
                </div>
            </div>

            <!-- Submit -->
            <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 10px;">
                –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É
            </button>
        </form>
    </div>

    <!-- Tab Bar Navigation -->
     <nav class="tab-bar">
        <a href="index.html" class="tab-item">
            <span class="tab-icon"></span>
            <span>–ì–ª–∞–≤–Ω–∞—è</span>
        </a>
        <a href="create-request.html" class="tab-item active">
            <span class="tab-icon"></span>
            <span>–ó–∞—è–≤–∫–∏</span>
        </a>
        <a href="payments.html" class="tab-item">
            <span class="tab-icon"></span>
            <span>–ü–ª–∞—Ç–µ–∂–∏</span>
        </a>
        <a href="cameras.html" class="tab-item">
            <span class="tab-icon"></span>
            <span>–ö–∞–º–µ—Ä—ã</span>
        </a>
    </nav>

    <script src="auth.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–º—ã –∏ –º–µ–¥–∏–∞
            if (window.uiModern) uiModern.initTheme();
            if (window.mediaModern) mediaModern.initMedia();

            // –°—á–µ—Ç—á–∏–∫ —Å–∏–º–≤–æ–ª–æ–≤
            const desc = document.getElementById('requestDescription');
            const counter = document.getElementById('charCount');
            if (desc && counter) {
                desc.addEventListener('input', () => {
                    counter.textContent = desc.value.length;
                });
            }

            // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã
            const form = document.getElementById('requestForm');
            if (form) {
                form.addEventListener('submit', (e) => {
                    e.preventDefault();
                    // Mock –æ—Ç–ø—Ä–∞–≤–∫–∞
                    const btn = form.querySelector('button[type="submit"]');
                    const originalText = btn.textContent;
                    btn.textContent = '–û—Ç–ø—Ä–∞–≤–∫–∞...';
                    btn.disabled = true;

                    setTimeout(() => {
                        alert('–ó–∞—è–≤–∫–∞ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –≤ —Å–∏—Å—Ç–µ–º—É VSK Desk!');
                        localStorage.removeItem('currentPhoto');
                        localStorage.removeItem('currentVideo');
                        localStorage.removeItem('currentAudio');
                        window.location.href = 'index.html';
                    }, 1500);
                });
            }
        });

        // –ü—Ä–æ—Å—Ç—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –º–µ–¥–∏–∞ (–µ—Å–ª–∏ media-modern.js –Ω–µ –ø–æ–¥—Ö–≤–∞—Ç–∏—Ç)
        function handlePhotoUpload(e) { if(window.mediaModern) mediaModern.handlePhotoUpload(e); }
        function handleVideoUpload(e) { if(window.mediaModern) mediaModern.handleVideoUpload(e); }
        function handleAudioUpload(e) { if(window.mediaModern) mediaModern.handleAudioUpload(e); }
        function deletePhoto() { if(window.mediaModern) mediaModern.deletePhoto(); }
        function deleteVideo() { if(window.mediaModern) mediaModern.deleteVideo(); }
        function deleteAudio() { if(window.mediaModern) mediaModern.deleteAudio(); }
        async function capturePhoto() {
            try {
                if (window.mediaFixed) {
                    await mediaFixed.capturePhotoFlow();
                } else if (window.mediaModern) {
                    // fallback: trigger file input
                    document.getElementById('photoFileInput')?.click();
                }
            } catch (err) {
                console.warn('capture fallback', err);
                document.getElementById('photoFileInput')?.click();
            }
        }
    </script>
<div class="version" style="text-align:center; padding: 20px 0; color: #999; font-size: 12px;">v7.0</div><script src="js/media-fixed.js"></script></body>
</html>

