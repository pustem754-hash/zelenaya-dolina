<!DOCTYPE html>
<!-- УК "Зелёная Долина" - Вход v6.8.2 -->
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Вход - УК Зелёная долина v6.8.2</title>
    <link rel="stylesheet" href="css/design-system.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/layout.css">
    <link rel="stylesheet" href="css/animations.css">
    <meta name="theme-color" content="#00A859">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="icon" href="./icon-48x48.png">
    <style>
        body { min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: var(--space-6); background: var(--color-bg); font-family: var(--font-family); }
        .login-card { max-width: 420px; width: 100%; }
        .version-badge { position: fixed; top: var(--space-4); right: var(--space-4); font-size: var(--font-size-xs); color: var(--color-text-secondary); }
    </style>
</head>
<body>
    <button id="theme-toggle" style="position: fixed; top: 10px; left: 10px; z-index: 9999; font-size: 24px; background: none; border: none; cursor: pointer;"></button>
    <script>
    const themeToggle = document.getElementById('theme-toggle');
    const currentTheme = localStorage.getItem('theme') || 'light';
    document.body.classList.add(`theme-${currentTheme}`);
    themeToggle.addEventListener('click', () => {
      const newTheme = document.body.classList.contains('theme-light') ? 'dark' : 'light';
      document.body.classList.remove('theme-light', 'theme-dark');
      document.body.classList.add(`theme-${newTheme}`);
      localStorage.setItem('theme', newTheme);
      console.log(` Тема изменена на: ${newTheme}`);
    });
    </script>
    <style>
    body.theme-dark { background: #1a1a1a; color: #f5f5f5; }
    body.theme-dark button { background: #2E7D32; color: #fff; }
    body.theme-dark input { background: #2a2a2a; color: #f5f5f5; border: 1px solid #444; }
    </style>

    <div class="version-badge">v6.8.2</div>
    <div class="login-card card card-glass animate-scale-in">
        <div class="card-header text-center">
            <h1 class="card-title"> УК Зелёная долина</h1>
            <p style="margin: var(--space-2) 0 0 0; font-size: var(--font-size-sm); color: var(--color-text-secondary);">Управляющая компания</p>
        </div>
        <div class="card-body">
            <form id="loginForm" onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label class="form-label required" for="phoneInput">Номер телефона</label>
                    <div class="input-icon-wrapper">
                        <span class="input-icon"></span>
                        <input type="tel" id="phoneInput" class="form-input" placeholder="+7 (999) 123-45-67" required autocomplete="off">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label required" for="codeInput">СМС-код</label>
                    <div class="input-icon-wrapper">
                        <span class="input-icon"></span>
                        <input type="text" id="codeInput" class="form-input" placeholder="1234" maxlength="4" required autocomplete="off">
                    </div>
                </div>
                <button type="submit" id="loginBtn" class="btn btn-primary" style="width: 100%;">Войти</button>
            </form>
        </div>
        <div class="card-footer text-center">
            <p style="margin: 0; font-size: var(--font-size-xs); color: var(--color-text-secondary);">Тестовый код: <strong>1234</strong></p>
        </div>
    </div>
    <div class="version" style="text-align:center; margin-top: var(--space-4); color: var(--color-text-secondary);">v6.8.2</div>
    <script src="js/ui-modern.js"></script>
    <script src="js/auth.js"></script>
    <script>
        console.log('[login.html v6.8.2] Страница входа загружена');
        console.log(' Сессия активна');
        console.log(' Неверный код');
        const phoneInput = document.getElementById('phoneInput');
        const codeInput = document.getElementById('codeInput');
        phoneInput.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length > 0 && !value.startsWith('7')) value = '7' + value;
            let formatted = '+7';
            if (value.length > 1) formatted += ' (' + value.substring(1, 4);
            if (value.length >= 5) formatted += ') ' + value.substring(4, 7);
            if (value.length >= 8) formatted += '-' + value.substring(7, 9);
            if (value.length >= 10) formatted += '-' + value.substring(9, 11);
            e.target.value = formatted;
        });
        codeInput.addEventListener('input', function(e) {
            e.target.value = e.target.value.replace(/\D/g, '').substring(0, 4);
        });
        async function handleLogin(e) {
            e.preventDefault();
            const phone = phoneInput.value;
            const code = codeInput.value;
            const loginBtn = document.getElementById('loginBtn');
            if (phone.length < 18 || code.length !== 4) {
                showNotification(' Заполните все поля корректно', 'error');
                return;
            }
            showButtonLoading(loginBtn);
            await login(phone, code);
            setTimeout(() => hideButtonLoading(loginBtn), 2000);
        }
        window.addEventListener('load', () => phoneInput.focus());
    </script>
</body>
</html>
