<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–ª–∞—Ç–µ–∂–∏ - –£–ö ¬´–ó–µ–ª—ë–Ω–∞—è –¥–æ–ª–∏–Ω–∞¬ª v6.3.1</title>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#2E7D32">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="icon" type="image/png" sizes="32x32" href="./icon-48x48.png">
    <link rel="icon" type="image/png" sizes="192x192" href="./icon-192x192.png">
    <link rel="apple-touch-icon" sizes="180x180" href="./icon-180x180.png">
    
    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
    <link rel="stylesheet" href="css/navigation.css">
    <script src="js/navigation.js" defer></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
            min-height: 100vh;
            padding: 20px 20px 100px 20px;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 5px;
        }
        
        .back-button {
            position: fixed;
            top: 20px;
            left: 20px;
            background: white;
            border: none;
            border-radius: 50%;
            width: 48px;
            height: 48px;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            z-index: 100;
        }
        
        .card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .total-card {
            background: linear-gradient(135deg, #2E7D32 0%, #27ae60 100%);
            color: white;
            text-align: center;
            padding: 30px;
            border-radius: 16px;
            margin-bottom: 20px;
        }
        
        .total-amount {
            font-size: 42px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .deadline {
            font-size: 16px;
            opacity: 0.9;
            margin-bottom: 20px;
        }
        
        .btn-primary {
            background: white;
            color: #2E7D32;
            border: none;
            border-radius: 12px;
            padding: 16px 32px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
        }
        
        .service-item {
            display: flex;
            align-items: center;
            padding: 16px;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .service-item:last-child {
            border-bottom: none;
        }
        
        .service-icon {
            font-size: 32px;
            margin-right: 16px;
            width: 48px;
            text-align: center;
        }
        
        .service-info {
            flex: 1;
        }
        
        .service-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 4px;
        }
        
        .service-consumption {
            font-size: 14px;
            color: #666;
        }
        
        .service-amount {
            font-size: 20px;
            font-weight: 600;
            color: #2E7D32;
        }
        
        .filter-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .filter-btn {
            padding: 10px 20px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .filter-btn.active {
            background: #2E7D32;
            color: white;
            border-color: #2E7D32;
        }
        
        .history-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px;
            background: #f8f9fa;
            border-radius: 12px;
            margin-bottom: 12px;
        }
        
        .history-date {
            font-size: 14px;
            color: #666;
        }
        
        .history-amount {
            font-size: 18px;
            font-weight: 600;
            color: #333;
        }
        
        .history-status {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .history-status.paid {
            background: #e8f5e9;
            color: #2e7d32;
        }
        
        .btn-download {
            background: #3498db;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 8px 16px;
            font-size: 14px;
            cursor: pointer;
        }
        
        .toggle-switch {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px;
            background: #f8f9fa;
            border-radius: 12px;
        }
        
        .toggle-switch input[type="checkbox"] {
            width: 50px;
            height: 28px;
            appearance: none;
            background: #ccc;
            border-radius: 14px;
            position: relative;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .toggle-switch input[type="checkbox"]:checked {
            background: #2E7D32;
        }
        
        .toggle-switch input[type="checkbox"]::before {
            content: '';
            position: absolute;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: white;
            top: 2px;
            left: 2px;
            transition: transform 0.3s;
        }
        
        .toggle-switch input[type="checkbox"]:checked::before {
            transform: translateX(22px);
        }
        
        .label-text {
            font-size: 16px;
            color: #333;
        }
    </style>
</head>
<body>
    <button class="back-button" onclick="window.location.href='index.html'">‚Üê</button>
    
    <div class="header">
        <h1>üí≥ –ü–ª–∞—Ç–µ–∂–∏ –∏ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è</h1>
    </div>
    
    <!-- –ò—Ç–æ–≥–æ–≤–∞—è —Å—É–º–º–∞ -->
    <div class="total-card">
        <div class="total-amount">10 693.65 ‚ÇΩ</div>
        <div class="deadline">–°—Ä–æ–∫ –æ–ø–ª–∞—Ç—ã: –¥–æ 28.10.2025</div>
        <button class="btn-primary" onclick="handlePaymentClick()">
            –û–ø–ª–∞—Ç–∏—Ç—å –æ–Ω–ª–∞–π–Ω
        </button>
    </div>
    
    <!-- –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ —É—Å–ª—É–≥–∞–º -->
    <div class="card">
        <h2 style="color: #2E7D32; margin-bottom: 20px;">–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π</h2>
        
        <div class="service-item">
            <div class="service-icon">üíß</div>
            <div class="service-info">
                <div class="service-name">–•–æ–ª–æ–¥–Ω–æ–µ –≤–æ–¥–æ—Å–Ω–∞–±–∂–µ–Ω–∏–µ</div>
                <div class="service-consumption">15.3 –º¬≥ √ó 45.20 ‚ÇΩ</div>
            </div>
            <div class="service-amount">691.56 ‚ÇΩ</div>
        </div>
        
        <div class="service-item">
            <div class="service-icon">üî•</div>
            <div class="service-info">
                <div class="service-name">–ì–æ—Ä—è—á–µ–µ –≤–æ–¥–æ—Å–Ω–∞–±–∂–µ–Ω–∏–µ</div>
                <div class="service-consumption">8.7 –º¬≥ √ó 178.40 ‚ÇΩ</div>
            </div>
            <div class="service-amount">1 552.08 ‚ÇΩ</div>
        </div>
        
        <div class="service-item">
            <div class="service-icon">‚ö°</div>
            <div class="service-info">
                <div class="service-name">–≠–ª–µ–∫—Ç—Ä–æ—ç–Ω–µ—Ä–≥–∏—è</div>
                <div class="service-consumption">245 –∫–í—Ç‚ãÖ—á √ó 5.38 ‚ÇΩ</div>
            </div>
            <div class="service-amount">1 318.10 ‚ÇΩ</div>
        </div>
        
        <div class="service-item">
            <div class="service-icon">üí®</div>
            <div class="service-info">
                <div class="service-name">–ì–∞–∑–æ—Å–Ω–∞–±–∂–µ–Ω–∏–µ</div>
                <div class="service-consumption">42.5 –º¬≥ √ó 7.85 ‚ÇΩ</div>
            </div>
            <div class="service-amount">333.63 ‚ÇΩ</div>
        </div>
        
        <div class="service-item">
            <div class="service-icon">üî•</div>
            <div class="service-info">
                <div class="service-name">–û—Ç–æ–ø–ª–µ–Ω–∏–µ</div>
                <div class="service-consumption">65 –º¬≤ √ó 45.80 ‚ÇΩ</div>
            </div>
            <div class="service-amount">2 977.00 ‚ÇΩ</div>
        </div>
        
        <div class="service-item">
            <div class="service-icon">üè¢</div>
            <div class="service-info">
                <div class="service-name">–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –∂–∏–ª—å—è</div>
                <div class="service-consumption">65 –º¬≤ √ó 28.50 ‚ÇΩ</div>
            </div>
            <div class="service-amount">1 852.50 ‚ÇΩ</div>
        </div>
        
        <div class="service-item">
            <div class="service-icon">üóëÔ∏è</div>
            <div class="service-info">
                <div class="service-name">–í—ã–≤–æ–∑ –º—É—Å–æ—Ä–∞</div>
                <div class="service-consumption">3 —á–µ–ª. √ó 120.00 ‚ÇΩ</div>
            </div>
            <div class="service-amount">360.00 ‚ÇΩ</div>
        </div>
    </div>
    
    <!-- –ò—Å—Ç–æ—Ä–∏—è –ø–ª–∞—Ç–µ–∂–µ–π -->
    <div class="card">
        <h2 style="color: #2E7D32; margin-bottom: 20px;">–ò—Å—Ç–æ—Ä–∏—è –ø–ª–∞—Ç–µ–∂–µ–π</h2>
        
        <div class="filter-buttons">
            <button class="filter-btn active" data-period="all" onclick="filterPayments('all')">–í—Å–µ</button>
            <button class="filter-btn" data-period="6m" onclick="filterPayments('6m')">6 –º–µ—Å—è—Ü–µ–≤</button>
            <button class="filter-btn" data-period="1y" onclick="filterPayments('1y')">–ì–æ–¥</button>
        </div>
        
        <div class="history-list" id="paymentHistoryList">
            <!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
        </div>
    </div>
    
    <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–ø–ª–∞—Ç–µ–∂–µ–π -->
    <div class="card">
        <h2 style="color: #2E7D32; margin-bottom: 20px;">‚öôÔ∏è –ê–≤—Ç–æ–ø–ª–∞—Ç—ë–∂</h2>
        <label class="toggle-switch">
            <input type="checkbox" id="autopayToggle" onchange="toggleAutopay()">
            <span class="label-text">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–ø–ª–∞—Ç–∞ –¥–æ 25 —á–∏—Å–ª–∞ –∫–∞–∂–¥–æ–≥–æ –º–µ—Å—è—Ü–∞</span>
        </label>
    </div>
    
    <script src="auth.js"></script>
    <script>
        // –í–ê–ñ–ù–û: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –¢–û–õ–¨–ö–û –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ DOM
        document.addEventListener('DOMContentLoaded', () => {
            console.log('[Page] –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏...');
            
            if (!requireAuth()) {
                console.log('[Page] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω, —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ login');
                return;
            }
            
            console.log('[Page] –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã...');
            initializePage();
        });
        
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        const paymentHistory = [
            { date: '2025-09-25', amount: 9845.30, status: 'paid', receipt: 'receipt-sep-2025.pdf' },
            { date: '2025-08-27', amount: 9123.15, status: 'paid', receipt: 'receipt-aug-2025.pdf' },
            { date: '2025-07-24', amount: 10205.80, status: 'paid', receipt: 'receipt-jul-2025.pdf' },
            { date: '2025-06-28', amount: 8967.40, status: 'paid', receipt: 'receipt-jun-2025.pdf' },
            { date: '2025-05-26', amount: 9534.20, status: 'paid', receipt: 'receipt-may-2025.pdf' }
        ];
        
        function formatDate(dateString) {
            const date = new Date(dateString);
            const months = ['—è–Ω–≤–∞—Ä—è', '—Ñ–µ–≤—Ä–∞–ª—è', '–º–∞—Ä—Ç–∞', '–∞–ø—Ä–µ–ª—è', '–º–∞—è', '–∏—é–Ω—è', '–∏—é–ª—è', '–∞–≤–≥—É—Å—Ç–∞', '—Å–µ–Ω—Ç—è–±—Ä—è', '–æ–∫—Ç—è–±—Ä—è', '–Ω–æ—è–±—Ä—è', '–¥–µ–∫–∞–±—Ä—è'];
            return `${date.getDate()} ${months[date.getMonth()]} ${date.getFullYear()}`;
        }
        
        function renderPaymentHistory(period = 'all') {
            const list = document.getElementById('paymentHistoryList');
            list.innerHTML = '';
            
            let filtered = paymentHistory;
            
            if (period === '6m') {
                const sixMonthsAgo = new Date();
                sixMonthsAgo.setMonth(sixMonthsAgo.getMonth() - 6);
                filtered = paymentHistory.filter(p => new Date(p.date) >= sixMonthsAgo);
            } else if (period === '1y') {
                const oneYearAgo = new Date();
                oneYearAgo.setFullYear(oneYearAgo.getFullYear() - 1);
                filtered = paymentHistory.filter(p => new Date(p.date) >= oneYearAgo);
            }
            
            if (filtered.length === 0) {
                list.innerHTML = '<p style="text-align: center; color: #999; padding: 20px;">–ù–µ—Ç –ø–ª–∞—Ç–µ–∂–µ–π –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥</p>';
                return;
            }
            
            filtered.forEach(payment => {
                const item = document.createElement('div');
                item.className = 'history-item';
                item.innerHTML = `
                    <div>
                        <div class="history-date">${formatDate(payment.date)}</div>
                        <div class="history-amount">${payment.amount.toFixed(2)} ‚ÇΩ</div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <div class="history-status paid">‚úì –û–ø–ª–∞—á–µ–Ω–æ</div>
                        <button class="btn-download" onclick="downloadReceipt('${payment.receipt}')">
                            üìÑ –ö–≤–∏—Ç–∞–Ω—Ü–∏—è
                        </button>
                    </div>
                `;
                list.appendChild(item);
            });
        }
        
        function filterPayments(period) {
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            renderPaymentHistory(period);
        }
        
        function downloadReceipt(filename) {
            alert(`–°–∫–∞—á–∏–≤–∞–Ω–∏–µ –∫–≤–∏—Ç–∞–Ω—Ü–∏–∏: ${filename}\n(–í production: –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ PDF)`);
        }
        
        function handlePaymentClick() {
            window.location.href = 'index.html';
        }
        
        function toggleAutopay() {
            const toggle = document.getElementById('autopayToggle');
            if (toggle.checked) {
                alert('–ê–≤—Ç–æ–ø–ª–∞—Ç—ë–∂ –≤–∫–ª—é—á—ë–Ω. –ü–ª–∞—Ç–µ–∂–∏ –±—É–¥—É—Ç —Å–ø–∏—Å—ã–≤–∞—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ 25 —á–∏—Å–ª–∞ –∫–∞–∂–¥–æ–≥–æ –º–µ—Å—è—Ü–∞.');
            } else {
                alert('–ê–≤—Ç–æ–ø–ª–∞—Ç—ë–∂ –æ—Ç–∫–ª—é—á—ë–Ω.');
            }
            localStorage.setItem('autopayEnabled', toggle.checked);
        }
        
        function initializePage() {
            const session = getSession();
            console.log('[Page] –°–µ—Å—Å–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', session);
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∞–≤—Ç–æ–ø–ª–∞—Ç–µ–∂–∞
            const autopayEnabled = localStorage.getItem('autopayEnabled') === 'true';
            document.getElementById('autopayToggle').checked = autopayEnabled;
            renderPaymentHistory('all');
        }
    </script>
</body>
</html>

