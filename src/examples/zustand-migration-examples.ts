п»їРїВ»С—Р С—Р’В»РЎвЂ”/**
 * Р В Р’В Р РЋРЎСџР В Р Р‹Р В РІР‚С™Р В Р’В Р РЋРІР‚ВР В Р’В Р РЋР’ВР В Р’В Р вЂ™Р’ВµР В Р Р‹Р В РІР‚С™Р В Р Р‹Р Р†Р вЂљРІвЂћвЂ“ Р В Р’В Р РЋР’ВР В Р’В Р РЋРІР‚ВР В Р’В Р РЋРІР‚вЂњР В Р Р‹Р В РІР‚С™Р В Р’В Р вЂ™Р’В°Р В Р Р‹Р Р†Р вЂљР’В Р В Р’В Р РЋРІР‚ВР В Р’В Р РЋРІР‚В Р В Р Р‹Р В РЎвЂњ localStorage/StorageService Р В Р’В Р В РІР‚В¦Р В Р’В Р вЂ™Р’В° Zustand Store
 * 
 * Р В Р’В Р вЂ™Р’ВР В Р Р‹Р В РЎвЂњР В Р’В Р РЋРІР‚вЂќР В Р’В Р РЋРІР‚СћР В Р’В Р вЂ™Р’В»Р В Р Р‹Р В Р вЂ°Р В Р’В Р вЂ™Р’В·Р В Р Р‹Р РЋРІР‚СљР В Р’В Р Р†РІР‚С›РІР‚вЂњР В Р Р‹Р Р†Р вЂљРЎв„ўР В Р’В Р вЂ™Р’Вµ Р В Р Р‹Р В Р Р‰Р В Р Р‹Р Р†Р вЂљРЎв„ўР В Р’В Р РЋРІР‚В Р В Р’В Р РЋРІР‚вЂќР В Р Р‹Р В РІР‚С™Р В Р’В Р РЋРІР‚ВР В Р’В Р РЋР’ВР В Р’В Р вЂ™Р’ВµР В Р Р‹Р В РІР‚С™Р В Р Р‹Р Р†Р вЂљРІвЂћвЂ“ Р В Р’В Р РЋРІР‚СњР В Р’В Р вЂ™Р’В°Р В Р’В Р РЋРІР‚Сњ Р В Р Р‹Р В РІР‚С™Р В Р’В Р вЂ™Р’ВµР В Р Р‹Р Р†Р вЂљРЎвЂєР В Р’В Р вЂ™Р’ВµР В Р Р‹Р В РІР‚С™Р В Р’В Р вЂ™Р’ВµР В Р’В Р В РІР‚В¦Р В Р Р‹Р В РЎвЂњ Р В Р’В Р РЋРІР‚вЂќР В Р Р‹Р В РІР‚С™Р В Р’В Р РЋРІР‚В Р В Р’В Р РЋР’ВР В Р’В Р РЋРІР‚ВР В Р’В Р РЋРІР‚вЂњР В Р Р‹Р В РІР‚С™Р В Р’В Р вЂ™Р’В°Р В Р Р‹Р Р†Р вЂљР’В Р В Р’В Р РЋРІР‚ВР В Р’В Р РЋРІР‚В index.html
 * 
 * @project Р В Р’В Р В РІвЂљВ¬Р В Р’В Р РЋРІвЂћСћ Р В РІР‚в„ўР вЂ™Р’В«Р В Р’В Р Р†Р вЂљРІР‚СњР В Р’В Р вЂ™Р’ВµР В Р’В Р вЂ™Р’В»Р В Р Р‹Р Р†Р вЂљР’ВР В Р’В Р В РІР‚В¦Р В Р’В Р вЂ™Р’В°Р В Р Р‹Р В Р РЏ Р В Р’В Р СћРІР‚ВР В Р’В Р РЋРІР‚СћР В Р’В Р вЂ™Р’В»Р В Р’В Р РЋРІР‚ВР В Р’В Р В РІР‚В¦Р В Р’В Р вЂ™Р’В°Р В РІР‚в„ўР вЂ™Р’В» v7.2.4
 */

import { useAppStore, useAuth, useMeters, useRequests, useMedia } from '../store';

// ============================================
// Р В Р’В Р РЋРЎСџР В Р’В Р вЂ™Р’В Р В Р’В Р вЂ™Р’ВР В Р’В Р РЋРЎв„ўР В Р’В Р Р†Р вЂљРЎС›Р В Р’В Р вЂ™Р’В  1: Р В Р’В Р РЋРІР‚в„ўР В Р’В Р Р†Р вЂљРІвЂћСћР В Р’В Р РЋРЎвЂєР В Р’В Р РЋРІР‚С”Р В Р’В Р вЂ™Р’В Р В Р’В Р вЂ™Р’ВР В Р’В Р Р†Р вЂљРІР‚СњР В Р’В Р РЋРІР‚в„ўР В Р’В Р вЂ™Р’В¦Р В Р’В Р вЂ™Р’ВР В Р’В Р В РІР‚РЋ
// ============================================

// Р В Р вЂ Р РЋРЎС™Р В Р вЂ° Р В Р’В Р Р†Р вЂљР’ВР В Р’В Р вЂ™Р’В«Р В Р’В Р Р†Р вЂљРЎвЂќР В Р’В Р РЋРІР‚С” (localStorage):
function loginOld(code: string) {
  const user = getUserByCode(code);
  localStorage.setItem('zd_login_code', code);
  localStorage.setItem('userData', JSON.stringify(user));
}

// Р В Р вЂ Р РЋРЎв„ўР Р†Р вЂљР’В¦ Р В Р’В Р В Р вЂ№Р В Р’В Р РЋРЎвЂєР В Р’В Р РЋРІР‚в„ўР В Р’В Р Р†Р вЂљРЎвЂќР В Р’В Р РЋРІР‚С” (Zustand):
function loginNew(code: string) {
  const { login } = useAppStore.getState();
  const user = getUserByCode(code);
  login(code, user);
}

// Р В Р вЂ Р РЋРЎС™Р В Р вЂ° Р В Р’В Р Р†Р вЂљР’ВР В Р’В Р вЂ™Р’В«Р В Р’В Р Р†Р вЂљРЎвЂќР В Р’В Р РЋРІР‚С”: Р В Р’В Р РЋРЎСџР В Р Р‹Р В РІР‚С™Р В Р’В Р РЋРІР‚СћР В Р’В Р В РІР‚В Р В Р’В Р вЂ™Р’ВµР В Р Р‹Р В РІР‚С™Р В Р’В Р РЋРІР‚СњР В Р’В Р вЂ™Р’В° Р В Р’В Р вЂ™Р’В°Р В Р’В Р В РІР‚В Р В Р Р‹Р Р†Р вЂљРЎв„ўР В Р’В Р РЋРІР‚СћР В Р Р‹Р В РІР‚С™Р В Р’В Р РЋРІР‚ВР В Р’В Р вЂ™Р’В·Р В Р’В Р вЂ™Р’В°Р В Р Р‹Р Р†Р вЂљР’В Р В Р’В Р РЋРІР‚ВР В Р’В Р РЋРІР‚В
function isAuthenticatedOld(): boolean {
  const code = localStorage.getItem('zd_login_code');
  return !!code;
}

// Р В Р вЂ Р РЋРЎв„ўР Р†Р вЂљР’В¦ Р В Р’В Р В Р вЂ№Р В Р’В Р РЋРЎвЂєР В Р’В Р РЋРІР‚в„ўР В Р’В Р Р†Р вЂљРЎвЂќР В Р’В Р РЋРІР‚С”:
function isAuthenticatedNew(): boolean {
  return useAppStore.getState().auth.isAuthenticated;
}

// Р В Р вЂ Р РЋРЎС™Р В Р вЂ° Р В Р’В Р Р†Р вЂљР’ВР В Р’В Р вЂ™Р’В«Р В Р’В Р Р†Р вЂљРЎвЂќР В Р’В Р РЋРІР‚С”: Р В Р’В Р Р†Р вЂљРІвЂћСћР В Р Р‹Р Р†Р вЂљРІвЂћвЂ“Р В Р Р‹Р Р†Р вЂљР’В¦Р В Р’В Р РЋРІР‚СћР В Р’В Р СћРІР‚В
function logoutOld() {
  localStorage.removeItem('zd_login_code');
  localStorage.removeItem('userData');
  window.location.href = 'login.html';
}

// Р В Р вЂ Р РЋРЎв„ўР Р†Р вЂљР’В¦ Р В Р’В Р В Р вЂ№Р В Р’В Р РЋРЎвЂєР В Р’В Р РЋРІР‚в„ўР В Р’В Р Р†Р вЂљРЎвЂќР В Р’В Р РЋРІР‚С”:
function logoutNew() {
  const { logout } = useAppStore.getState();
  logout();
  window.location.href = 'login.html';
}

// ============================================
// Р В Р’В Р РЋРЎСџР В Р’В Р вЂ™Р’В Р В Р’В Р вЂ™Р’ВР В Р’В Р РЋРЎв„ўР В Р’В Р Р†Р вЂљРЎС›Р В Р’В Р вЂ™Р’В  2: Р В Р’В Р РЋРЎСџР В Р’В Р РЋРІР‚С”Р В Р’В Р РЋРІвЂћСћР В Р’В Р РЋРІР‚в„ўР В Р’В Р Р†Р вЂљРІР‚СњР В Р’В Р РЋРІР‚в„ўР В Р’В Р РЋРЎС™Р В Р’В Р вЂ™Р’ВР В Р’В Р В РІР‚РЋ Р В Р’В Р В Р вЂ№Р В Р’В Р вЂ™Р’В§Р В Р’В Р В РЎвЂњР В Р’В Р РЋРЎвЂєР В Р’В Р вЂ™Р’В§Р В Р’В Р вЂ™Р’ВР В Р’В Р РЋРІвЂћСћР В Р’В Р РЋРІР‚С”Р В Р’В Р Р†Р вЂљРІвЂћСћ
// ============================================

// Р В Р вЂ Р РЋРЎС™Р В Р вЂ° Р В Р’В Р Р†Р вЂљР’ВР В Р’В Р вЂ™Р’В«Р В Р’В Р Р†Р вЂљРЎвЂќР В Р’В Р РЋРІР‚С”:
function submitMetersOld(coldWater: number, hotWater: number, electricity: number, gas: number) {
  // Р В Р’В Р вЂ™Р’ВР В Р Р‹Р В РЎвЂњР В Р Р‹Р Р†Р вЂљРЎв„ўР В Р’В Р РЋРІР‚СћР В Р Р‹Р В РІР‚С™Р В Р’В Р РЋРІР‚ВР В Р Р‹Р В Р РЏ
  let history = JSON.parse(localStorage.getItem('metersHistory') || '[]');
  history.unshift({
    coldWater,
    hotWater,
    electricity,
    gas,
    date: new Date().toISOString(),
    timestamp: Date.now(),
  });
  if (history.length > 50) history = history.slice(0, 50);
  localStorage.setItem('metersHistory', JSON.stringify(history));
  
  // Р В Р’В Р РЋРЎСџР В Р’В Р РЋРІР‚СћР В Р Р‹Р В РЎвЂњР В Р’В Р вЂ™Р’В»Р В Р’В Р вЂ™Р’ВµР В Р’В Р СћРІР‚ВР В Р’В Р В РІР‚В¦Р В Р’В Р РЋРІР‚ВР В Р’В Р вЂ™Р’Вµ Р В Р’В Р РЋРІР‚вЂќР В Р’В Р РЋРІР‚СћР В Р’В Р РЋРІР‚СњР В Р’В Р вЂ™Р’В°Р В Р’В Р вЂ™Р’В·Р В Р’В Р вЂ™Р’В°Р В Р’В Р В РІР‚В¦Р В Р’В Р РЋРІР‚ВР В Р Р‹Р В Р РЏ
  localStorage.setItem('lastColdWater', String(coldWater));
  localStorage.setItem('lastHotWater', String(hotWater));
  localStorage.setItem('lastElectricity', String(electricity));
  localStorage.setItem('lastGas', String(gas));
}

// Р В Р вЂ Р РЋРЎв„ўР Р†Р вЂљР’В¦ Р В Р’В Р В Р вЂ№Р В Р’В Р РЋРЎвЂєР В Р’В Р РЋРІР‚в„ўР В Р’В Р Р†Р вЂљРЎвЂќР В Р’В Р РЋРІР‚С”:
function submitMetersNew(coldWater: number, hotWater: number, electricity: number, gas: number) {
  const { addMeterReading, updateLastReading } = useAppStore.getState();
  
  // Р В Р’В Р Р†Р вЂљРЎСљР В Р’В Р РЋРІР‚СћР В Р’В Р вЂ™Р’В±Р В Р’В Р вЂ™Р’В°Р В Р’В Р В РІР‚В Р В Р’В Р вЂ™Р’В»Р В Р Р‹Р В Р РЏР В Р’В Р вЂ™Р’ВµР В Р’В Р РЋР’В Р В Р’В Р РЋРІР‚вЂќР В Р’В Р РЋРІР‚Сћ Р В Р’В Р РЋРІР‚СћР В Р’В Р СћРІР‚ВР В Р’В Р В РІР‚В¦Р В Р’В Р РЋРІР‚СћР В Р’В Р РЋР’ВР В Р Р‹Р РЋРІР‚Сљ Р В Р’В Р РЋРІР‚вЂќР В Р’В Р РЋРІР‚СћР В Р’В Р РЋРІР‚СњР В Р’В Р вЂ™Р’В°Р В Р’В Р вЂ™Р’В·Р В Р’В Р вЂ™Р’В°Р В Р’В Р В РІР‚В¦Р В Р’В Р РЋРІР‚ВР В Р Р‹Р В РІР‚в„– Р В Р’В Р СћРІР‚ВР В Р’В Р вЂ™Р’В»Р В Р Р‹Р В Р РЏ Р В Р’В Р РЋРІР‚СњР В Р’В Р вЂ™Р’В°Р В Р’В Р вЂ™Р’В¶Р В Р’В Р СћРІР‚ВР В Р’В Р РЋРІР‚СћР В Р’В Р РЋРІР‚вЂњР В Р’В Р РЋРІР‚Сћ Р В Р Р‹Р Р†Р вЂљРЎв„ўР В Р’В Р РЋРІР‚ВР В Р’В Р РЋРІР‚вЂќР В Р’В Р вЂ™Р’В°
  ['coldWater', 'hotWater', 'electricity', 'gas'].forEach((type, index) => {
    const values = [coldWater, hotWater, electricity, gas];
    addMeterReading({
      type: type as any,
      value: values[index],
      date: new Date().toISOString(),
    });
  });
}

// Р В Р вЂ Р РЋРЎС™Р В Р вЂ° Р В Р’В Р Р†Р вЂљР’ВР В Р’В Р вЂ™Р’В«Р В Р’В Р Р†Р вЂљРЎвЂќР В Р’В Р РЋРІР‚С”: Р В Р’В Р вЂ™Р’В§Р В Р Р‹Р Р†Р вЂљРЎв„ўР В Р’В Р вЂ™Р’ВµР В Р’В Р В РІР‚В¦Р В Р’В Р РЋРІР‚ВР В Р’В Р вЂ™Р’Вµ Р В Р’В Р РЋРІР‚ВР В Р Р‹Р В РЎвЂњР В Р Р‹Р Р†Р вЂљРЎв„ўР В Р’В Р РЋРІР‚СћР В Р Р‹Р В РІР‚С™Р В Р’В Р РЋРІР‚ВР В Р’В Р РЋРІР‚В
function getMetersHistoryOld() {
  return JSON.parse(localStorage.getItem('metersHistory') || '[]');
}

// Р В Р вЂ Р РЋРЎв„ўР Р†Р вЂљР’В¦ Р В Р’В Р В Р вЂ№Р В Р’В Р РЋРЎвЂєР В Р’В Р РЋРІР‚в„ўР В Р’В Р Р†Р вЂљРЎвЂќР В Р’В Р РЋРІР‚С”:
function getMetersHistoryNew() {
  return useAppStore.getState().meters.history;
}

// Р В Р вЂ Р РЋРЎС™Р В Р вЂ° Р В Р’В Р Р†Р вЂљР’ВР В Р’В Р вЂ™Р’В«Р В Р’В Р Р†Р вЂљРЎвЂќР В Р’В Р РЋРІР‚С”: Р В Р’В Р РЋРЎСџР В Р’В Р РЋРІР‚СћР В Р Р‹Р В РЎвЂњР В Р’В Р вЂ™Р’В»Р В Р’В Р вЂ™Р’ВµР В Р’В Р СћРІР‚ВР В Р’В Р В РІР‚В¦Р В Р’В Р РЋРІР‚ВР В Р’В Р вЂ™Р’Вµ Р В Р’В Р РЋРІР‚вЂќР В Р’В Р РЋРІР‚СћР В Р’В Р РЋРІР‚СњР В Р’В Р вЂ™Р’В°Р В Р’В Р вЂ™Р’В·Р В Р’В Р вЂ™Р’В°Р В Р’В Р В РІР‚В¦Р В Р’В Р РЋРІР‚ВР В Р Р‹Р В Р РЏ
function getLastReadingsOld() {
  return {
    coldWater: localStorage.getItem('lastColdWater'),
    hotWater: localStorage.getItem('lastHotWater'),
    electricity: localStorage.getItem('lastElectricity'),
    gas: localStorage.getItem('lastGas'),
  };
}

// Р В Р вЂ Р РЋРЎв„ўР Р†Р вЂљР’В¦ Р В Р’В Р В Р вЂ№Р В Р’В Р РЋРЎвЂєР В Р’В Р РЋРІР‚в„ўР В Р’В Р Р†Р вЂљРЎвЂќР В Р’В Р РЋРІР‚С”:
function getLastReadingsNew() {
  return useAppStore.getState().meters.lastReadings;
}

// ============================================
// Р В Р’В Р РЋРЎСџР В Р’В Р вЂ™Р’В Р В Р’В Р вЂ™Р’ВР В Р’В Р РЋРЎв„ўР В Р’В Р Р†Р вЂљРЎС›Р В Р’В Р вЂ™Р’В  3: Р В Р’В Р Р†Р вЂљРІР‚СњР В Р’В Р РЋРІР‚в„ўР В Р’В Р В РІР‚РЋР В Р’В Р Р†Р вЂљРІвЂћСћР В Р’В Р РЋРІвЂћСћР В Р’В Р вЂ™Р’В
// ============================================

// Р В Р вЂ Р РЋРЎС™Р В Р вЂ° Р В Р’В Р Р†Р вЂљР’ВР В Р’В Р вЂ™Р’В«Р В Р’В Р Р†Р вЂљРЎвЂќР В Р’В Р РЋРІР‚С”:
function createRequestOld(category: string, description: string, photos: any[], videos: any[], audio: any[]) {
  const requests = JSON.parse(localStorage.getItem('requests') || '[]');
  
  const newRequest = {
    id: Date.now(),
    category,
    categoryName: getCategoryName(category),
    description,
    photos,
    videos,
    audio,
    status: 'created',
    statusName: 'Р В Р’В Р В Р вЂ№Р В Р’В Р РЋРІР‚СћР В Р’В Р вЂ™Р’В·Р В Р’В Р СћРІР‚ВР В Р’В Р вЂ™Р’В°Р В Р’В Р В РІР‚В¦Р В Р’В Р вЂ™Р’В°',
    date: new Date().toISOString(),
    dateFormatted: new Date().toLocaleString('ru-RU'),
    dispatcherPhotos: [],
  };
  
  requests.unshift(newRequest);
  localStorage.setItem('requests', JSON.stringify(requests));
  
  // Р В Р’В Р РЋРІР‚С”Р В Р Р‹Р Р†Р вЂљР Р‹Р В Р’В Р РЋРІР‚ВР В Р Р‹Р В РЎвЂњР В Р Р‹Р Р†Р вЂљРЎв„ўР В Р’В Р РЋРІР‚ВР В Р Р‹Р Р†Р вЂљРЎв„ўР В Р Р‹Р В Р вЂ° Р В Р’В Р РЋР’ВР В Р’В Р вЂ™Р’ВµР В Р’В Р СћРІР‚ВР В Р’В Р РЋРІР‚ВР В Р’В Р вЂ™Р’В°
  localStorage.removeItem('photos');
  localStorage.removeItem('videos');
  localStorage.removeItem('audio');
}

// Р В Р вЂ Р РЋРЎв„ўР Р†Р вЂљР’В¦ Р В Р’В Р В Р вЂ№Р В Р’В Р РЋРЎвЂєР В Р’В Р РЋРІР‚в„ўР В Р’В Р Р†Р вЂљРЎвЂќР В Р’В Р РЋРІР‚С”:
function createRequestNew(category: string, description: string, photos: any[], videos: any[], audio: any[]) {
  const { addRequest } = useAppStore.getState();
  const { media } = useAppStore.getState();
  
  const newRequest = {
    id: Date.now(),
    category,
    categoryName: getCategoryName(category),
    description,
    photos: media.photos,
    videos: media.videos,
    audio: media.audio,
    status: 'created' as const,
    statusName: 'Р В Р’В Р В Р вЂ№Р В Р’В Р РЋРІР‚СћР В Р’В Р вЂ™Р’В·Р В Р’В Р СћРІР‚ВР В Р’В Р вЂ™Р’В°Р В Р’В Р В РІР‚В¦Р В Р’В Р вЂ™Р’В°',
    date: new Date().toISOString(),
    dateFormatted: new Date().toLocaleString('ru-RU'),
    dispatcherPhotos: [],
  };
  
  addRequest(newRequest);
  
  // Р В Р’В Р РЋРІР‚С”Р В Р Р‹Р Р†Р вЂљР Р‹Р В Р’В Р РЋРІР‚ВР В Р Р‹Р В РЎвЂњР В Р Р‹Р Р†Р вЂљРЎв„ўР В Р’В Р РЋРІР‚ВР В Р Р‹Р Р†Р вЂљРЎв„ўР В Р Р‹Р В Р вЂ° Р В Р’В Р РЋР’ВР В Р’В Р вЂ™Р’ВµР В Р’В Р СћРІР‚ВР В Р’В Р РЋРІР‚ВР В Р’В Р вЂ™Р’В° Р В Р Р‹Р Р†Р вЂљР Р‹Р В Р’В Р вЂ™Р’ВµР В Р Р‹Р В РІР‚С™Р В Р’В Р вЂ™Р’ВµР В Р’В Р вЂ™Р’В· actions (Р В Р’В Р вЂ™Р’ВµР В Р Р‹Р В РЎвЂњР В Р’В Р вЂ™Р’В»Р В Р’В Р РЋРІР‚В Р В Р’В Р В РІР‚В¦Р В Р Р‹Р РЋРІР‚СљР В Р’В Р вЂ™Р’В¶Р В Р’В Р В РІР‚В¦Р В Р’В Р РЋРІР‚Сћ)
  // Р В Р’В Р вЂ™Р’ВР В Р’В Р вЂ™Р’В»Р В Р’В Р РЋРІР‚В Р В Р’В Р РЋРІР‚СћР В Р Р‹Р В РЎвЂњР В Р Р‹Р Р†Р вЂљРЎв„ўР В Р’В Р вЂ™Р’В°Р В Р’В Р В РІР‚В Р В Р’В Р РЋРІР‚ВР В Р Р‹Р Р†Р вЂљРЎв„ўР В Р Р‹Р В Р вЂ° - Р В Р Р‹Р В РІР‚С™Р В Р’В Р вЂ™Р’ВµР В Р Р‹Р Р†РІР‚С™Р’В¬Р В Р’В Р вЂ™Р’ВµР В Р’В Р В РІР‚В¦Р В Р’В Р РЋРІР‚ВР В Р’В Р вЂ™Р’Вµ Р В Р’В Р вЂ™Р’В°Р В Р Р‹Р В РІР‚С™Р В Р Р‹Р Р†Р вЂљР’В¦Р В Р’В Р РЋРІР‚ВР В Р Р‹Р Р†Р вЂљРЎв„ўР В Р’В Р вЂ™Р’ВµР В Р’В Р РЋРІР‚СњР В Р Р‹Р Р†Р вЂљРЎв„ўР В Р Р‹Р РЋРІР‚СљР В Р Р‹Р В РІР‚С™Р В Р’В Р В РІР‚В¦Р В Р’В Р РЋРІР‚СћР В Р’В Р вЂ™Р’Вµ
}

// Р В Р вЂ Р РЋРЎС™Р В Р вЂ° Р В Р’В Р Р†Р вЂљР’ВР В Р’В Р вЂ™Р’В«Р В Р’В Р Р†Р вЂљРЎвЂќР В Р’В Р РЋРІР‚С”: Р В Р’В Р В Р вЂ№Р В Р’В Р РЋРІР‚вЂќР В Р’В Р РЋРІР‚ВР В Р Р‹Р В РЎвЂњР В Р’В Р РЋРІР‚СћР В Р’В Р РЋРІР‚Сњ Р В Р’В Р вЂ™Р’В·Р В Р’В Р вЂ™Р’В°Р В Р Р‹Р В Р РЏР В Р’В Р В РІР‚В Р В Р’В Р РЋРІР‚СћР В Р’В Р РЋРІР‚Сњ
function getRequestsOld(filterStatus?: string) {
  const requests = JSON.parse(localStorage.getItem('requests') || '[]');
  if (!filterStatus || filterStatus === 'all') {
    return requests;
  }
  return requests.filter((r: any) => r.status === filterStatus);
}

// Р В Р вЂ Р РЋРЎв„ўР Р†Р вЂљР’В¦ Р В Р’В Р В Р вЂ№Р В Р’В Р РЋРЎвЂєР В Р’В Р РЋРІР‚в„ўР В Р’В Р Р†Р вЂљРЎвЂќР В Р’В Р РЋРІР‚С”:
function getRequestsNew(filterStatus?: string) {
  const { requests } = useAppStore.getState();
  if (!filterStatus || filterStatus === 'all') {
    return requests;
  }
  return requests.filter(r => r.status === filterStatus);
}

// ============================================
// Р В Р’В Р РЋРЎСџР В Р’В Р вЂ™Р’В Р В Р’В Р вЂ™Р’ВР В Р’В Р РЋРЎв„ўР В Р’В Р Р†Р вЂљРЎС›Р В Р’В Р вЂ™Р’В  4: Р В Р’В Р вЂ™Р’В¤Р В Р’В Р РЋРІР‚С”Р В Р’В Р РЋРЎвЂєР В Р’В Р РЋРІР‚С”/Р В Р’В Р Р†Р вЂљРІвЂћСћР В Р’В Р вЂ™Р’ВР В Р’В Р Р†Р вЂљРЎСљР В Р’В Р Р†Р вЂљРЎС›Р В Р’В Р РЋРІР‚С”/Р В Р’В Р РЋРІР‚в„ўР В Р’В Р В РІвЂљВ¬Р В Р’В Р Р†Р вЂљРЎСљР В Р’В Р вЂ™Р’ВР В Р’В Р РЋРІР‚С”
// ============================================

// Р В Р вЂ Р РЋРЎС™Р В Р вЂ° Р В Р’В Р Р†Р вЂљР’ВР В Р’В Р вЂ™Р’В«Р В Р’В Р Р†Р вЂљРЎвЂќР В Р’В Р РЋРІР‚С”: Р В Р’В Р Р†Р вЂљРЎСљР В Р’В Р РЋРІР‚СћР В Р’В Р вЂ™Р’В±Р В Р’В Р вЂ™Р’В°Р В Р’В Р В РІР‚В Р В Р’В Р вЂ™Р’В»Р В Р’В Р вЂ™Р’ВµР В Р’В Р В РІР‚В¦Р В Р’В Р РЋРІР‚ВР В Р’В Р вЂ™Р’Вµ Р В Р Р‹Р Р†Р вЂљРЎвЂєР В Р’В Р РЋРІР‚СћР В Р Р‹Р Р†Р вЂљРЎв„ўР В Р’В Р РЋРІР‚Сћ
function addPhotoOld(photoData: any, type: 'request' | 'counter') {
  const storageKey = type === 'counter' ? 'counterPhotos' : 'requestPhotos';
  const photos = JSON.parse(localStorage.getItem(storageKey) || '[]');
  photos.push(photoData);
  localStorage.setItem(storageKey, JSON.stringify(photos));
}

// Р В Р вЂ Р РЋРЎв„ўР Р†Р вЂљР’В¦ Р В Р’В Р В Р вЂ№Р В Р’В Р РЋРЎвЂєР В Р’В Р РЋРІР‚в„ўР В Р’В Р Р†Р вЂљРЎвЂќР В Р’В Р РЋРІР‚С”:
function addPhotoNew(photoData: any, type: 'request' | 'counter') {
  const { addPhoto } = useAppStore.getState();
  addPhoto({
    id: photoData.id || crypto.randomUUID(),
    url: photoData.data || photoData.url,
    timestamp: photoData.timestamp || Date.now(),
  }, type);
}

// Р В Р вЂ Р РЋРЎС™Р В Р вЂ° Р В Р’В Р Р†Р вЂљР’ВР В Р’В Р вЂ™Р’В«Р В Р’В Р Р†Р вЂљРЎвЂќР В Р’В Р РЋРІР‚С”: Р В Р’В Р В РІвЂљВ¬Р В Р’В Р СћРІР‚ВР В Р’В Р вЂ™Р’В°Р В Р’В Р вЂ™Р’В»Р В Р’В Р вЂ™Р’ВµР В Р’В Р В РІР‚В¦Р В Р’В Р РЋРІР‚ВР В Р’В Р вЂ™Р’Вµ Р В Р Р‹Р Р†Р вЂљРЎвЂєР В Р’В Р РЋРІР‚СћР В Р Р‹Р Р†Р вЂљРЎв„ўР В Р’В Р РЋРІР‚Сћ
function deletePhotoOld(id: string, type: 'request' | 'counter') {
  const storageKey = type === 'counter' ? 'counterPhotos' : 'requestPhotos';
  let photos = JSON.parse(localStorage.getItem(storageKey) || '[]');
  photos = photos.filter((p: any) => p.id !== id);
  localStorage.setItem(storageKey, JSON.stringify(photos));
}

// Р В Р вЂ Р РЋРЎв„ўР Р†Р вЂљР’В¦ Р В Р’В Р В Р вЂ№Р В Р’В Р РЋРЎвЂєР В Р’В Р РЋРІР‚в„ўР В Р’В Р Р†Р вЂљРЎвЂќР В Р’В Р РЋРІР‚С”:
function deletePhotoNew(id: string, type: 'request' | 'counter') {
  const { deletePhoto } = useAppStore.getState();
  deletePhoto(id, type);
}

// Р В Р вЂ Р РЋРЎС™Р В Р вЂ° Р В Р’В Р Р†Р вЂљР’ВР В Р’В Р вЂ™Р’В«Р В Р’В Р Р†Р вЂљРЎвЂќР В Р’В Р РЋРІР‚С”: Р В Р’В Р вЂ™Р’В Р В Р’В Р вЂ™Р’ВµР В Р’В Р В РІР‚В¦Р В Р’В Р СћРІР‚ВР В Р’В Р вЂ™Р’ВµР В Р Р‹Р В РІР‚С™Р В Р’В Р РЋРІР‚ВР В Р’В Р В РІР‚В¦Р В Р’В Р РЋРІР‚вЂњ Р В Р Р‹Р Р†Р вЂљРЎвЂєР В Р’В Р РЋРІР‚СћР В Р Р‹Р Р†Р вЂљРЎв„ўР В Р’В Р РЋРІР‚Сћ
function renderPhotosOld() {
  const photos = JSON.parse(localStorage.getItem('requestPhotos') || '[]');
  const container = document.getElementById('photosContainer');
  
  if (!container) return;
  
  if (photos.length === 0) {
    container.innerHTML = '<p>Р В Р’В Р РЋРЎС™Р В Р’В Р вЂ™Р’ВµР В Р Р‹Р Р†Р вЂљРЎв„ў Р В Р Р‹Р Р†Р вЂљРЎвЂєР В Р’В Р РЋРІР‚СћР В Р Р‹Р Р†Р вЂљРЎв„ўР В Р’В Р РЋРІР‚Сћ</p>';
    return;
  }
  
  container.innerHTML = photos.map((photo: any) => `
    <div class="photo-item">
      <img src="${photo.data}" />
      <button onclick="deletePhoto('${photo.id}')">Р В Р’В Р В РІвЂљВ¬Р В Р’В Р СћРІР‚ВР В Р’В Р вЂ™Р’В°Р В Р’В Р вЂ™Р’В»Р В Р’В Р РЋРІР‚ВР В Р Р‹Р Р†Р вЂљРЎв„ўР В Р Р‹Р В Р вЂ°</button>
    </div>
  `).join('');
}

// Р В Р вЂ Р РЋРЎв„ўР Р†Р вЂљР’В¦ Р В Р’В Р В Р вЂ№Р В Р’В Р РЋРЎвЂєР В Р’В Р РЋРІР‚в„ўР В Р’В Р Р†Р вЂљРЎвЂќР В Р’В Р РЋРІР‚С”:
function renderPhotosNew() {
  const { requestPhotos } = useAppStore.getState().media;
  const container = document.getElementById('photosContainer');
  
  if (!container) return;
  
  if (requestPhotos.length === 0) {
    container.innerHTML = '<p>Р В Р’В Р РЋРЎС™Р В Р’В Р вЂ™Р’ВµР В Р Р‹Р Р†Р вЂљРЎв„ў Р В Р Р‹Р Р†Р вЂљРЎвЂєР В Р’В Р РЋРІР‚СћР В Р Р‹Р Р†Р вЂљРЎв„ўР В Р’В Р РЋРІР‚Сћ</p>';
    return;
  }
  
  container.innerHTML = requestPhotos.map((photo) => `
    <div class="photo-item">
      <img src="${photo.url}" />
      <button onclick="deletePhotoFromStore('${photo.id}')">Р В Р’В Р В РІвЂљВ¬Р В Р’В Р СћРІР‚ВР В Р’В Р вЂ™Р’В°Р В Р’В Р вЂ™Р’В»Р В Р’В Р РЋРІР‚ВР В Р Р‹Р Р†Р вЂљРЎв„ўР В Р Р‹Р В Р вЂ°</button>
    </div>
  `).join('');
}

// Р В Р’В Р Р†Р вЂљРЎС™Р В Р’В Р вЂ™Р’В»Р В Р’В Р РЋРІР‚СћР В Р’В Р вЂ™Р’В±Р В Р’В Р вЂ™Р’В°Р В Р’В Р вЂ™Р’В»Р В Р Р‹Р В Р вЂ°Р В Р’В Р В РІР‚В¦Р В Р’В Р вЂ™Р’В°Р В Р Р‹Р В Р РЏ Р В Р Р‹Р Р†Р вЂљРЎвЂєР В Р Р‹Р РЋРІР‚СљР В Р’В Р В РІР‚В¦Р В Р’В Р РЋРІР‚СњР В Р Р‹Р Р†Р вЂљР’В Р В Р’В Р РЋРІР‚ВР В Р Р‹Р В Р РЏ Р В Р’В Р СћРІР‚ВР В Р’В Р вЂ™Р’В»Р В Р Р‹Р В Р РЏ Р В Р’В Р РЋРІР‚СњР В Р’В Р В РІР‚В¦Р В Р’В Р РЋРІР‚СћР В Р’В Р РЋРІР‚вЂќР В Р’В Р РЋРІР‚СњР В Р’В Р РЋРІР‚В
(window as any).deletePhotoFromStore = (id: string) => {
  const { deletePhoto } = useAppStore.getState();
  deletePhoto(id, 'request');
  renderPhotosNew(); // Р В Р’В Р РЋРЎСџР В Р’В Р вЂ™Р’ВµР В Р Р‹Р В РІР‚С™Р В Р’В Р вЂ™Р’ВµР В Р Р‹Р В РІР‚С™Р В Р’В Р РЋРІР‚ВР В Р Р‹Р В РЎвЂњР В Р’В Р РЋРІР‚СћР В Р’В Р В РІР‚В Р В Р’В Р вЂ™Р’В°Р В Р Р‹Р Р†Р вЂљРЎв„ўР В Р Р‹Р В Р вЂ°
};

// ============================================
// Р В Р’В Р РЋРЎСџР В Р’В Р вЂ™Р’В Р В Р’В Р вЂ™Р’ВР В Р’В Р РЋРЎв„ўР В Р’В Р Р†Р вЂљРЎС›Р В Р’В Р вЂ™Р’В  5: Р В Р’В Р вЂ™Р’В Р В Р’В Р Р†Р вЂљРЎС›Р В Р’В Р РЋРІР‚в„ўР В Р’В Р РЋРІвЂћСћР В Р’В Р РЋРЎвЂєР В Р’В Р вЂ™Р’ВР В Р’В Р Р†Р вЂљРІвЂћСћР В Р’В Р РЋРЎС™Р В Р’В Р вЂ™Р’В«Р В Р’В Р Р†Р вЂљРЎС› Р В Р’В Р РЋРІвЂћСћР В Р’В Р РЋРІР‚С”Р В Р’В Р РЋРЎв„ўР В Р’В Р РЋРЎСџР В Р’В Р РЋРІР‚С”Р В Р’В Р РЋРЎС™Р В Р’В Р Р†Р вЂљРЎС›Р В Р’В Р РЋРЎС™Р В Р’В Р РЋРЎвЂєР В Р’В Р вЂ™Р’В« (Subscribe)
// ============================================

// Р В Р вЂ Р РЋРЎС™Р В Р вЂ° Р В Р’В Р Р†Р вЂљР’ВР В Р’В Р вЂ™Р’В«Р В Р’В Р Р†Р вЂљРЎвЂќР В Р’В Р РЋРІР‚С”: Р В Р’В Р вЂ™Р’В Р В Р Р‹Р РЋРІР‚СљР В Р Р‹Р Р†Р вЂљР Р‹Р В Р’В Р В РІР‚В¦Р В Р’В Р РЋРІР‚СћР В Р’В Р вЂ™Р’Вµ Р В Р’В Р РЋРІР‚СћР В Р’В Р вЂ™Р’В±Р В Р’В Р В РІР‚В¦Р В Р’В Р РЋРІР‚СћР В Р’В Р В РІР‚В Р В Р’В Р вЂ™Р’В»Р В Р’В Р вЂ™Р’ВµР В Р’В Р В РІР‚В¦Р В Р’В Р РЋРІР‚ВР В Р’В Р вЂ™Р’Вµ UI
function updateUI() {
  const user = JSON.parse(localStorage.getItem('userData') || 'null');
  if (user) {
    document.getElementById('userName')!.textContent = user.name;
  }
}

// Р В Р вЂ Р РЋРЎв„ўР Р†Р вЂљР’В¦ Р В Р’В Р В Р вЂ№Р В Р’В Р РЋРЎвЂєР В Р’В Р РЋРІР‚в„ўР В Р’В Р Р†Р вЂљРЎвЂќР В Р’В Р РЋРІР‚С”: Р В Р’В Р РЋРІР‚в„ўР В Р’В Р В РІР‚В Р В Р Р‹Р Р†Р вЂљРЎв„ўР В Р’В Р РЋРІР‚СћР В Р’В Р РЋР’ВР В Р’В Р вЂ™Р’В°Р В Р Р‹Р Р†Р вЂљРЎв„ўР В Р’В Р РЋРІР‚ВР В Р Р‹Р Р†Р вЂљР Р‹Р В Р’В Р вЂ™Р’ВµР В Р Р‹Р В РЎвЂњР В Р’В Р РЋРІР‚СњР В Р’В Р РЋРІР‚СћР В Р’В Р вЂ™Р’Вµ Р В Р’В Р РЋРІР‚СћР В Р’В Р вЂ™Р’В±Р В Р’В Р В РІР‚В¦Р В Р’В Р РЋРІР‚СћР В Р’В Р В РІР‚В Р В Р’В Р вЂ™Р’В»Р В Р’В Р вЂ™Р’ВµР В Р’В Р В РІР‚В¦Р В Р’В Р РЋРІР‚ВР В Р’В Р вЂ™Р’Вµ Р В Р Р‹Р Р†Р вЂљР Р‹Р В Р’В Р вЂ™Р’ВµР В Р Р‹Р В РІР‚С™Р В Р’В Р вЂ™Р’ВµР В Р’В Р вЂ™Р’В· subscribe
function setupReactiveUI() {
  // Р В Р’В Р РЋРЎСџР В Р’В Р РЋРІР‚СћР В Р’В Р СћРІР‚ВР В Р’В Р РЋРІР‚вЂќР В Р’В Р РЋРІР‚ВР В Р Р‹Р В РЎвЂњР В Р’В Р вЂ™Р’В°Р В Р Р‹Р Р†Р вЂљРЎв„ўР В Р Р‹Р В Р вЂ°Р В Р Р‹Р В РЎвЂњР В Р Р‹Р В Р РЏ Р В Р’В Р В РІР‚В¦Р В Р’В Р вЂ™Р’В° Р В Р’В Р РЋРІР‚ВР В Р’В Р вЂ™Р’В·Р В Р’В Р РЋР’ВР В Р’В Р вЂ™Р’ВµР В Р’В Р В РІР‚В¦Р В Р’В Р вЂ™Р’ВµР В Р’В Р В РІР‚В¦Р В Р’В Р РЋРІР‚ВР В Р Р‹Р В Р РЏ user
  useAppStore.subscribe(
    (state) => state.auth.user,
    (user) => {
      // Р В Р’В Р вЂ™Р’В­Р В Р Р‹Р Р†Р вЂљРЎв„ўР В Р’В Р РЋРІР‚СћР В Р Р‹Р Р†Р вЂљРЎв„ў callback Р В Р’В Р В РІР‚В Р В Р Р‹Р Р†Р вЂљРІвЂћвЂ“Р В Р’В Р вЂ™Р’В·Р В Р Р‹Р Р†Р вЂљРІвЂћвЂ“Р В Р’В Р В РІР‚В Р В Р’В Р вЂ™Р’В°Р В Р’В Р вЂ™Р’ВµР В Р Р‹Р Р†Р вЂљРЎв„ўР В Р Р‹Р В РЎвЂњР В Р Р‹Р В Р РЏ Р В Р’В Р вЂ™Р’В°Р В Р’В Р В РІР‚В Р В Р Р‹Р Р†Р вЂљРЎв„ўР В Р’В Р РЋРІР‚СћР В Р’В Р РЋР’ВР В Р’В Р вЂ™Р’В°Р В Р Р‹Р Р†Р вЂљРЎв„ўР В Р’В Р РЋРІР‚ВР В Р Р‹Р Р†Р вЂљР Р‹Р В Р’В Р вЂ™Р’ВµР В Р Р‹Р В РЎвЂњР В Р’В Р РЋРІР‚СњР В Р’В Р РЋРІР‚В Р В Р’В Р РЋРІР‚вЂќР В Р Р‹Р В РІР‚С™Р В Р’В Р РЋРІР‚В Р В Р’В Р РЋРІР‚ВР В Р’В Р вЂ™Р’В·Р В Р’В Р РЋР’ВР В Р’В Р вЂ™Р’ВµР В Р’В Р В РІР‚В¦Р В Р’В Р вЂ™Р’ВµР В Р’В Р В РІР‚В¦Р В Р’В Р РЋРІР‚ВР В Р’В Р РЋРІР‚В user
      if (user) {
        document.getElementById('userName')!.textContent = user.name;
      }
    }
  );
  
  // Р В Р’В Р РЋРЎСџР В Р’В Р РЋРІР‚СћР В Р’В Р СћРІР‚ВР В Р’В Р РЋРІР‚вЂќР В Р’В Р РЋРІР‚ВР В Р Р‹Р В РЎвЂњР В Р’В Р вЂ™Р’В°Р В Р Р‹Р Р†Р вЂљРЎв„ўР В Р Р‹Р В Р вЂ°Р В Р Р‹Р В РЎвЂњР В Р Р‹Р В Р РЏ Р В Р’В Р В РІР‚В¦Р В Р’В Р вЂ™Р’В° Р В Р’В Р РЋРІР‚ВР В Р’В Р вЂ™Р’В·Р В Р’В Р РЋР’ВР В Р’В Р вЂ™Р’ВµР В Р’В Р В РІР‚В¦Р В Р’В Р вЂ™Р’ВµР В Р’В Р В РІР‚В¦Р В Р’В Р РЋРІР‚ВР В Р Р‹Р В Р РЏ requests
  useAppStore.subscribe(
    (state) => state.requests,
    (requests) => {
      renderRequestsList(requests);
    }
  );
  
  // Р В Р’В Р РЋРЎСџР В Р’В Р РЋРІР‚СћР В Р’В Р СћРІР‚ВР В Р’В Р РЋРІР‚вЂќР В Р’В Р РЋРІР‚ВР В Р Р‹Р В РЎвЂњР В Р’В Р вЂ™Р’В°Р В Р Р‹Р Р†Р вЂљРЎв„ўР В Р Р‹Р В Р вЂ°Р В Р Р‹Р В РЎвЂњР В Р Р‹Р В Р РЏ Р В Р’В Р В РІР‚В¦Р В Р’В Р вЂ™Р’В° Р В Р’В Р РЋРІР‚ВР В Р’В Р вЂ™Р’В·Р В Р’В Р РЋР’ВР В Р’В Р вЂ™Р’ВµР В Р’В Р В РІР‚В¦Р В Р’В Р вЂ™Р’ВµР В Р’В Р В РІР‚В¦Р В Р’В Р РЋРІР‚ВР В Р Р‹Р В Р РЏ meters
  useAppStore.subscribe(
    (state) => state.meters.history,
    (history) => {
      renderMetersHistory(history);
    }
  );
}

// Р В Р’В Р Р†Р вЂљРІвЂћСћР В Р Р‹Р Р†Р вЂљРІвЂћвЂ“Р В Р’В Р вЂ™Р’В·Р В Р’В Р В РІР‚В Р В Р’В Р вЂ™Р’В°Р В Р Р‹Р Р†Р вЂљРЎв„ўР В Р Р‹Р В Р вЂ° Р В Р’В Р РЋРІР‚вЂќР В Р Р‹Р В РІР‚С™Р В Р’В Р РЋРІР‚В Р В Р’В Р вЂ™Р’В·Р В Р’В Р вЂ™Р’В°Р В Р’В Р РЋРІР‚вЂњР В Р Р‹Р В РІР‚С™Р В Р Р‹Р РЋРІР‚СљР В Р’В Р вЂ™Р’В·Р В Р’В Р РЋРІР‚СњР В Р’В Р вЂ™Р’Вµ
document.addEventListener('DOMContentLoaded', () => {
  setupReactiveUI();
});

// ============================================
// Р В Р’В Р РЋРЎСџР В Р’В Р вЂ™Р’В Р В Р’В Р вЂ™Р’ВР В Р’В Р РЋРЎв„ўР В Р’В Р Р†Р вЂљРЎС›Р В Р’В Р вЂ™Р’В  6: Р В Р’В Р вЂ™Р’ВР В Р’В Р РЋРЎС™Р В Р’В Р вЂ™Р’ВР В Р’В Р вЂ™Р’В¦Р В Р’В Р вЂ™Р’ВР В Р’В Р РЋРІР‚в„ўР В Р’В Р Р†Р вЂљРЎвЂќР В Р’В Р вЂ™Р’ВР В Р’В Р Р†Р вЂљРІР‚СњР В Р’В Р РЋРІР‚в„ўР В Р’В Р вЂ™Р’В¦Р В Р’В Р вЂ™Р’ВР В Р’В Р В РІР‚РЋ Р В Р’В Р РЋРЎСџР В Р’В Р вЂ™Р’В Р В Р’В Р вЂ™Р’ВР В Р’В Р Р†Р вЂљРЎвЂќР В Р’В Р РЋРІР‚С”Р В Р’В Р Р†Р вЂљРІР‚СљР В Р’В Р Р†Р вЂљРЎС›Р В Р’В Р РЋРЎС™Р В Р’В Р вЂ™Р’ВР В Р’В Р В РІР‚РЋ
// ============================================

// Р В Р вЂ Р РЋРЎС™Р В Р вЂ° Р В Р’В Р Р†Р вЂљР’ВР В Р’В Р вЂ™Р’В«Р В Р’В Р Р†Р вЂљРЎвЂќР В Р’В Р РЋРІР‚С”:
function initAppOld() {
  // Р В Р’В Р РЋРЎСџР В Р Р‹Р В РІР‚С™Р В Р’В Р РЋРІР‚СћР В Р’В Р В РІР‚В Р В Р’В Р вЂ™Р’ВµР В Р Р‹Р В РІР‚С™Р В Р’В Р РЋРІР‚ВР В Р Р‹Р Р†Р вЂљРЎв„ўР В Р Р‹Р В Р вЂ° Р В Р’В Р вЂ™Р’В°Р В Р’В Р В РІР‚В Р В Р Р‹Р Р†Р вЂљРЎв„ўР В Р’В Р РЋРІР‚СћР В Р Р‹Р В РІР‚С™Р В Р’В Р РЋРІР‚ВР В Р’В Р вЂ™Р’В·Р В Р’В Р вЂ™Р’В°Р В Р Р‹Р Р†Р вЂљР’В Р В Р’В Р РЋРІР‚ВР В Р Р‹Р В РІР‚в„–
  const code = localStorage.getItem('zd_login_code');
  if (!code) {
    window.location.href = 'login.html';
    return;
  }
  
  // Р В Р’В Р Р†Р вЂљРІР‚СњР В Р’В Р вЂ™Р’В°Р В Р’В Р РЋРІР‚вЂњР В Р Р‹Р В РІР‚С™Р В Р Р‹Р РЋРІР‚СљР В Р’В Р вЂ™Р’В·Р В Р’В Р РЋРІР‚ВР В Р Р‹Р Р†Р вЂљРЎв„ўР В Р Р‹Р В Р вЂ° Р В Р’В Р СћРІР‚ВР В Р’В Р вЂ™Р’В°Р В Р’В Р В РІР‚В¦Р В Р’В Р В РІР‚В¦Р В Р Р‹Р Р†Р вЂљРІвЂћвЂ“Р В Р’В Р вЂ™Р’Вµ
  const user = JSON.parse(localStorage.getItem('userData') || 'null');
  const requests = JSON.parse(localStorage.getItem('requests') || '[]');
  const meters = JSON.parse(localStorage.getItem('metersHistory') || '[]');
  
  // Р В Р’В Р РЋРІР‚С”Р В Р Р‹Р Р†Р вЂљРЎв„ўР В Р Р‹Р В РІР‚С™Р В Р’В Р РЋРІР‚ВР В Р Р‹Р В РЎвЂњР В Р’В Р РЋРІР‚СћР В Р’В Р В РІР‚В Р В Р’В Р вЂ™Р’В°Р В Р Р‹Р Р†Р вЂљРЎв„ўР В Р Р‹Р В Р вЂ° UI
  updateUI();
  renderRequests(requests);
  renderMeters(meters);
}

// Р В Р вЂ Р РЋРЎв„ўР Р†Р вЂљР’В¦ Р В Р’В Р В Р вЂ№Р В Р’В Р РЋРЎвЂєР В Р’В Р РЋРІР‚в„ўР В Р’В Р Р†Р вЂљРЎвЂќР В Р’В Р РЋРІР‚С”:
function initAppNew() {
  // Р В Р’В Р В Р вЂ№Р В Р’В Р РЋРІР‚ВР В Р’В Р В РІР‚В¦Р В Р Р‹Р Р†Р вЂљР’В¦Р В Р Р‹Р В РІР‚С™Р В Р’В Р РЋРІР‚СћР В Р’В Р В РІР‚В¦Р В Р’В Р РЋРІР‚ВР В Р’В Р вЂ™Р’В·Р В Р’В Р РЋРІР‚ВР В Р Р‹Р В РІР‚С™Р В Р’В Р РЋРІР‚СћР В Р’В Р В РІР‚В Р В Р’В Р вЂ™Р’В°Р В Р Р‹Р Р†Р вЂљРЎв„ўР В Р Р‹Р В Р вЂ° store Р В Р Р‹Р В РЎвЂњ StorageService
  const { syncWithStorage, auth } = useAppStore.getState();
  syncWithStorage();
  
  // Р В Р’В Р РЋРЎСџР В Р Р‹Р В РІР‚С™Р В Р’В Р РЋРІР‚СћР В Р’В Р В РІР‚В Р В Р’В Р вЂ™Р’ВµР В Р Р‹Р В РІР‚С™Р В Р’В Р РЋРІР‚ВР В Р Р‹Р Р†Р вЂљРЎв„ўР В Р Р‹Р В Р вЂ° Р В Р’В Р вЂ™Р’В°Р В Р’В Р В РІР‚В Р В Р Р‹Р Р†Р вЂљРЎв„ўР В Р’В Р РЋРІР‚СћР В Р Р‹Р В РІР‚С™Р В Р’В Р РЋРІР‚ВР В Р’В Р вЂ™Р’В·Р В Р’В Р вЂ™Р’В°Р В Р Р‹Р Р†Р вЂљР’В Р В Р’В Р РЋРІР‚ВР В Р Р‹Р В РІР‚в„–
  if (!auth.isAuthenticated) {
    window.location.href = 'login.html';
    return;
  }
  
  // Р В Р’В Р РЋРЎС™Р В Р’В Р вЂ™Р’В°Р В Р Р‹Р В РЎвЂњР В Р Р‹Р Р†Р вЂљРЎв„ўР В Р Р‹Р В РІР‚С™Р В Р’В Р РЋРІР‚СћР В Р’В Р РЋРІР‚ВР В Р Р‹Р Р†Р вЂљРЎв„ўР В Р Р‹Р В Р вЂ° Р В Р Р‹Р В РІР‚С™Р В Р’В Р вЂ™Р’ВµР В Р’В Р вЂ™Р’В°Р В Р’В Р РЋРІР‚СњР В Р Р‹Р Р†Р вЂљРЎв„ўР В Р’В Р РЋРІР‚ВР В Р’В Р В РІР‚В Р В Р’В Р В РІР‚В¦Р В Р’В Р РЋРІР‚СћР В Р Р‹Р В РЎвЂњР В Р Р‹Р Р†Р вЂљРЎв„ўР В Р Р‹Р В Р вЂ°
  setupReactiveUI();
  
  // UI Р В Р’В Р РЋРІР‚СћР В Р’В Р вЂ™Р’В±Р В Р’В Р В РІР‚В¦Р В Р’В Р РЋРІР‚СћР В Р’В Р В РІР‚В Р В Р’В Р РЋРІР‚ВР В Р Р‹Р Р†Р вЂљРЎв„ўР В Р Р‹Р В РЎвЂњР В Р Р‹Р В Р РЏ Р В Р’В Р вЂ™Р’В°Р В Р’В Р В РІР‚В Р В Р Р‹Р Р†Р вЂљРЎв„ўР В Р’В Р РЋРІР‚СћР В Р’В Р РЋР’ВР В Р’В Р вЂ™Р’В°Р В Р Р‹Р Р†Р вЂљРЎв„ўР В Р’В Р РЋРІР‚ВР В Р Р‹Р Р†Р вЂљР Р‹Р В Р’В Р вЂ™Р’ВµР В Р Р‹Р В РЎвЂњР В Р’В Р РЋРІР‚СњР В Р’В Р РЋРІР‚В Р В Р Р‹Р Р†Р вЂљР Р‹Р В Р’В Р вЂ™Р’ВµР В Р Р‹Р В РІР‚С™Р В Р’В Р вЂ™Р’ВµР В Р’В Р вЂ™Р’В· subscribe!
}

// ============================================
// Р В Р’В Р РЋРЎСџР В Р’В Р вЂ™Р’В Р В Р’В Р вЂ™Р’ВР В Р’В Р РЋРЎв„ўР В Р’В Р Р†Р вЂљРЎС›Р В Р’В Р вЂ™Р’В  7: Р В Р’В Р РЋРЎвЂєР В Р’В Р вЂ™Р’ВР В Р’В Р РЋРЎСџР В Р’В Р РЋРІР‚С”Р В Р’В Р Р†Р вЂљР’ВР В Р’В Р Р†Р вЂљРЎС›Р В Р’В Р Р†Р вЂљРІР‚СњР В Р’В Р РЋРІР‚С”Р В Р’В Р РЋРЎСџР В Р’В Р РЋРІР‚в„ўР В Р’В Р В Р вЂ№Р В Р’В Р РЋРЎС™Р В Р’В Р вЂ™Р’В«Р В Р’В Р Р†Р вЂљРЎС› Р В Р’В Р В Р вЂ№Р В Р’В Р Р†Р вЂљРЎС›Р В Р’В Р Р†Р вЂљРЎвЂќР В Р’В Р Р†Р вЂљРЎС›Р В Р’В Р РЋРІвЂћСћР В Р’В Р РЋРЎвЂєР В Р’В Р РЋРІР‚С”Р В Р’В Р вЂ™Р’В Р В Р’В Р вЂ™Р’В«
// ============================================

import { selectUser, selectMetersHistory, selectActiveRequests } from '../store';

// Р В Р’В Р вЂ™Р’ВР В Р Р‹Р В РЎвЂњР В Р’В Р РЋРІР‚вЂќР В Р’В Р РЋРІР‚СћР В Р’В Р вЂ™Р’В»Р В Р Р‹Р В Р вЂ°Р В Р’В Р вЂ™Р’В·Р В Р’В Р РЋРІР‚СћР В Р’В Р В РІР‚В Р В Р’В Р вЂ™Р’В°Р В Р’В Р В РІР‚В¦Р В Р’В Р РЋРІР‚ВР В Р’В Р вЂ™Р’Вµ Р В Р Р‹Р В РЎвЂњР В Р’В Р вЂ™Р’ВµР В Р’В Р вЂ™Р’В»Р В Р’В Р вЂ™Р’ВµР В Р’В Р РЋРІР‚СњР В Р Р‹Р Р†Р вЂљРЎв„ўР В Р’В Р РЋРІР‚СћР В Р Р‹Р В РІР‚С™Р В Р’В Р РЋРІР‚СћР В Р’В Р В РІР‚В 
function useTypeSafeData() {
  // Р В Р’В Р РЋРІР‚в„ўР В Р’В Р В РІР‚В Р В Р Р‹Р Р†Р вЂљРЎв„ўР В Р’В Р РЋРІР‚СћР В Р’В Р РЋР’ВР В Р’В Р вЂ™Р’В°Р В Р Р‹Р Р†Р вЂљРЎв„ўР В Р’В Р РЋРІР‚ВР В Р Р‹Р Р†Р вЂљР Р‹Р В Р’В Р вЂ™Р’ВµР В Р Р‹Р В РЎвЂњР В Р’В Р РЋРІР‚СњР В Р’В Р вЂ™Р’В°Р В Р Р‹Р В Р РЏ Р В Р Р‹Р Р†Р вЂљРЎв„ўР В Р’В Р РЋРІР‚ВР В Р’В Р РЋРІР‚вЂќР В Р’В Р РЋРІР‚ВР В Р’В Р вЂ™Р’В·Р В Р’В Р вЂ™Р’В°Р В Р Р‹Р Р†Р вЂљР’В Р В Р’В Р РЋРІР‚ВР В Р Р‹Р В Р РЏ!
  const user = useAppStore(selectUser); // user: User | null
  const history = useAppStore(selectMetersHistory); // history: MeterReading[]
  const activeRequests = useAppStore(selectActiveRequests); // activeRequests: Request[]
  
  // TypeScript Р В Р’В Р РЋРІР‚вЂќР В Р Р‹Р В РІР‚С™Р В Р’В Р РЋРІР‚СћР В Р’В Р В РІР‚В Р В Р’В Р вЂ™Р’ВµР В Р Р‹Р В РІР‚С™Р В Р’В Р РЋРІР‚ВР В Р Р‹Р Р†Р вЂљРЎв„ў Р В Р Р‹Р Р†Р вЂљРЎв„ўР В Р’В Р РЋРІР‚ВР В Р’В Р РЋРІР‚вЂќР В Р Р‹Р Р†Р вЂљРІвЂћвЂ“
  if (user) {
    console.log(user.name.toUpperCase()); // Р В Р вЂ Р РЋРЎв„ўР Р†Р вЂљР’В¦ OK
    // console.log(user.invalidField); // Р В Р вЂ Р РЋРЎС™Р В Р вЂ° TypeScript error!
  }
  
  return { user, history, activeRequests };
}

// ============================================
// Р В Р’В Р СћРЎвЂ™Р В Р’В Р Р†Р вЂљРЎС›Р В Р’В Р Р†Р вЂљРЎвЂќР В Р’В Р РЋРЎСџР В Р’В Р Р†Р вЂљРЎС›Р В Р’В Р вЂ™Р’В : Р В Р’В Р РЋРЎСџР В Р’В Р РЋРІР‚СћР В Р’В Р вЂ™Р’В»Р В Р Р‹Р РЋРІР‚СљР В Р Р‹Р Р†Р вЂљР Р‹Р В Р’В Р вЂ™Р’ВµР В Р’В Р В РІР‚В¦Р В Р’В Р РЋРІР‚ВР В Р’В Р вЂ™Р’Вµ Р В Р’В Р РЋРІР‚вЂќР В Р’В Р РЋРІР‚СћР В Р’В Р вЂ™Р’В»Р В Р Р‹Р В Р вЂ°Р В Р’В Р вЂ™Р’В·Р В Р’В Р РЋРІР‚СћР В Р’В Р В РІР‚В Р В Р’В Р вЂ™Р’В°Р В Р Р‹Р Р†Р вЂљРЎв„ўР В Р’В Р вЂ™Р’ВµР В Р’В Р вЂ™Р’В»Р В Р Р‹Р В Р РЏ Р В Р’В Р РЋРІР‚вЂќР В Р’В Р РЋРІР‚Сћ Р В Р’В Р РЋРІР‚СњР В Р’В Р РЋРІР‚СћР В Р’В Р СћРІР‚ВР В Р Р‹Р РЋРІР‚Сљ
// ============================================

function getUserByCode(code: string): any {
  // Mock Р В Р’В Р СћРІР‚ВР В Р’В Р вЂ™Р’В°Р В Р’В Р В РІР‚В¦Р В Р’В Р В РІР‚В¦Р В Р Р‹Р Р†Р вЂљРІвЂћвЂ“Р В Р’В Р вЂ™Р’Вµ (Р В Р’В Р вЂ™Р’В·Р В Р’В Р вЂ™Р’В°Р В Р’В Р РЋР’ВР В Р’В Р вЂ™Р’ВµР В Р’В Р В РІР‚В¦Р В Р’В Р РЋРІР‚ВР В Р Р‹Р Р†Р вЂљРЎв„ўР В Р Р‹Р В Р вЂ° Р В Р’В Р В РІР‚В¦Р В Р’В Р вЂ™Р’В° Р В Р Р‹Р В РІР‚С™Р В Р’В Р вЂ™Р’ВµР В Р’В Р вЂ™Р’В°Р В Р’В Р вЂ™Р’В»Р В Р Р‹Р В Р вЂ°Р В Р’В Р В РІР‚В¦Р В Р Р‹Р Р†Р вЂљРІвЂћвЂ“Р В Р’В Р Р†РІР‚С›РІР‚вЂњ API)
  const residents: Record<string, any> = {
    '1977': {
      id: '1977',
      code: '1977',
      name: 'Р В Р’В Р вЂ™Р’ВР В Р’В Р В РІР‚В Р В Р’В Р вЂ™Р’В°Р В Р’В Р В РІР‚В¦Р В Р’В Р РЋРІР‚СћР В Р’В Р В РІР‚В  Р В Р’В Р вЂ™Р’ВР В Р’В Р В РІР‚В Р В Р’В Р вЂ™Р’В°Р В Р’В Р В РІР‚В¦ Р В Р’В Р вЂ™Р’ВР В Р’В Р В РІР‚В Р В Р’В Р вЂ™Р’В°Р В Р’В Р В РІР‚В¦Р В Р’В Р РЋРІР‚СћР В Р’В Р В РІР‚В Р В Р’В Р РЋРІР‚ВР В Р Р‹Р Р†Р вЂљР Р‹',
      fullName: 'Р В Р’В Р вЂ™Р’ВР В Р’В Р В РІР‚В Р В Р’В Р вЂ™Р’В°Р В Р’В Р В РІР‚В¦Р В Р’В Р РЋРІР‚СћР В Р’В Р В РІР‚В  Р В Р’В Р вЂ™Р’ВР В Р’В Р В РІР‚В Р В Р’В Р вЂ™Р’В°Р В Р’В Р В РІР‚В¦ Р В Р’В Р вЂ™Р’ВР В Р’В Р В РІР‚В Р В Р’В Р вЂ™Р’В°Р В Р’В Р В РІР‚В¦Р В Р’В Р РЋРІР‚СћР В Р’В Р В РІР‚В Р В Р’В Р РЋРІР‚ВР В Р Р‹Р Р†Р вЂљР Р‹',
      accountNumber: '25-0-1977',
      apartment: '45',
      house: '25',
    },
  };
  
  return residents[code] || null;
}

function getCategoryName(category: string): string {
  const names: Record<string, string> = {
    plumbing: 'Р В Р’В Р В Р вЂ№Р В Р’В Р вЂ™Р’В°Р В Р’В Р В РІР‚В¦Р В Р Р‹Р Р†Р вЂљРЎв„ўР В Р’В Р вЂ™Р’ВµР В Р Р‹Р Р†Р вЂљР’В¦Р В Р’В Р В РІР‚В¦Р В Р’В Р РЋРІР‚ВР В Р’В Р РЋРІР‚СњР В Р’В Р вЂ™Р’В°',
    electric: 'Р В Р’В Р вЂ™Р’В­Р В Р’В Р вЂ™Р’В»Р В Р’В Р вЂ™Р’ВµР В Р’В Р РЋРІР‚СњР В Р Р‹Р Р†Р вЂљРЎв„ўР В Р Р‹Р В РІР‚С™Р В Р’В Р РЋРІР‚ВР В Р’В Р РЋРІР‚СњР В Р’В Р вЂ™Р’В°',
    cleaning: 'Р В Р’В Р В РІвЂљВ¬Р В Р’В Р вЂ™Р’В±Р В Р’В Р РЋРІР‚СћР В Р Р‹Р В РІР‚С™Р В Р’В Р РЋРІР‚СњР В Р’В Р вЂ™Р’В°',
    other: 'Р В Р’В Р Р†Р вЂљРЎСљР В Р Р‹Р В РІР‚С™Р В Р Р‹Р РЋРІР‚СљР В Р’В Р РЋРІР‚вЂњР В Р’В Р РЋРІР‚СћР В Р’В Р вЂ™Р’Вµ',
  };
  return names[category] || category;
}

// Р В Р’В Р Р†Р вЂљРІР‚СњР В Р’В Р вЂ™Р’В°Р В Р’В Р РЋРІР‚вЂњР В Р’В Р вЂ™Р’В»Р В Р Р‹Р РЋРІР‚СљР В Р Р‹Р Р†РІР‚С™Р’В¬Р В Р’В Р РЋРІР‚СњР В Р’В Р РЋРІР‚В Р В Р’В Р СћРІР‚ВР В Р’В Р вЂ™Р’В»Р В Р Р‹Р В Р РЏ Р В Р’В Р РЋРІР‚вЂќР В Р Р‹Р В РІР‚С™Р В Р’В Р РЋРІР‚ВР В Р’В Р РЋР’ВР В Р’В Р вЂ™Р’ВµР В Р Р‹Р В РІР‚С™Р В Р’В Р вЂ™Р’В°
function renderRequestsList(requests: any[]) {}
function renderMetersHistory(history: any[]) {}

console.log('Р РЋР вЂљР РЋРЎСџР Р†Р вЂљРЎС™Р РЋРІвЂћСћ Zustand Migration Examples loaded');









